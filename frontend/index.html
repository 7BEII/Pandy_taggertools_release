<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pandy AI Â∑•ÂÖ∑ÁÆ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-50" x-data="taggerApp()" x-init="init()">
    
    <!-- ‰∏ªÂÆπÂô® -->
    <div class="flex h-screen overflow-hidden">
        
        <!-- Â∑¶‰æßËæπÊ†èÔºàËÆ≠ÁªÉÂàÜÊûêÂô®ÂíåAIÂØπËØùÊ®°Âºè‰∏ãÈöêËóèÔºâ -->
        <div x-show="modelMode !== 'analyzer'" class="w-80 bg-white border-r border-gray-200 flex flex-col">
            <!-- Logo Âå∫Âüü -->
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-blue-500 rounded-lg flex items-center justify-center text-white text-xl font-bold">
                        üêº
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-gray-800">Pandy AI ÊâìÊ†áÂô®</h1>
                        <p class="text-xs text-gray-500">MULTI-PROVIDER SUPPORT</p>
                    </div>
                </div>
            </div>

            <!-- ÈÖçÁΩÆÂå∫Âüü -->
            <div class="flex-1 overflow-y-auto p-6 space-y-6">
                
                <!-- ÈÄâÊã©APIÊ∏†ÈÅìÔºàÁªü‰∏Ä‰ΩøÁî®apikeyConfigÔºâ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">API Ê∏†ÈÅì</label>
                    <select x-model="apikeyConfig.current_provider" @change="onProviderChange()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <template x-for="(provider, key) in apikeyConfig.providers" :key="key">
                            <option :value="key" x-text="providerNames[key]"></option>
                        </template>
                    </select>
                </div>

                <!-- ÈÄâÊã©Ê®°ÂûãÔºàÁªü‰∏Ä‰ΩøÁî®apikeyConfigÔºâ -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©Ê®°Âûã</label>
                    <select x-model="apikeyConfig.model" @change="saveApikeyConfig(true)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <template x-for="model in getCurrentProviderModels()" :key="model.id">
                            <option :value="model.id" x-text="model.name"></option>
                        </template>
                    </select>
                </div>

                <!-- ChatÔºöÂØπËØùÂéÜÂè≤ -->
                <div x-show="modelMode === 'chat'" class="space-y-3">
                    <div class="h-px bg-gray-200"></div>
                    <div class="flex items-center justify-between">
                        <h3 class="text-sm font-medium text-gray-700">üìö ÂØπËØùÂéÜÂè≤</h3>
                        <button @click="createNewChat()" class="px-2 py-1 text-xs bg-violet-600 text-white rounded hover:bg-violet-700 transition-colors">‚ûï Êñ∞ÂØπËØù</button>
                    </div>

                    <div class="space-y-2">
                        <template x-if="chatSessions.length === 0">
                            <div class="text-xs text-gray-400 text-center py-4">ÊöÇÊó†ÂØπËØùÂéÜÂè≤</div>
                        </template>
                        <template x-for="(session, index) in chatSessions" :key="session.id">
                            <div
                                @click="loadChatSession(session.id)"
                                :class="currentChatSessionId === session.id ? 'bg-violet-50 border-violet-300' : 'bg-gray-50 border-gray-200 hover:bg-gray-100'"
                                class="p-3 rounded-lg border cursor-pointer transition-colors group"
                            >
                                <div class="flex items-start justify-between">
                                    <div class="flex-1 min-w-0">
                                        <div class="text-sm font-medium text-gray-800 truncate" x-text="session.title"></div>
                                        <div class="text-xs text-gray-500 mt-1" x-text="session.time"></div>
                                        <div class="text-xs text-gray-400 mt-1" x-text="session.messageCount + ' Êù°Ê∂àÊÅØ'"></div>
                                    </div>
                                    <button @click.stop="deleteChatSession(session.id)" class="opacity-0 group-hover:opacity-100 text-red-500 hover:text-red-700 transition-opacity">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>

                <!-- Á≥ªÁªüÊèêÁ§∫ËØç -->
                <div class="hidden">
                    <button @click="showSystemPrompt = !showSystemPrompt" class="w-full flex items-center justify-between text-sm font-medium text-gray-700 mb-2">
                        <span>Á≥ªÁªüÊèêÁ§∫ËØçÔºàÂèçÊé®Ôºâ</span>
                        <svg :class="{'rotate-180': showSystemPrompt}" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <textarea x-show="showSystemPrompt" x-model="config.system_prompt" @blur="saveConfig()" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none"></textarea>
                </div>

                <!-- Áî®Êà∑Êåá‰ª§ -->
                <div class="hidden">
                    <button @click="showUserPrompt = !showUserPrompt" class="w-full flex items-center justify-between text-sm font-medium text-gray-700 mb-2">
                        <span>Áî®Êà∑Êåá‰ª§ÔºàÂèçÊé®Ôºâ</span>
                        <svg :class="{'rotate-180': showUserPrompt}" class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <textarea x-show="showUserPrompt" x-model="config.user_prompt" @blur="saveConfig()" rows="6" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none"></textarea>
                </div>

                <!-- ÂºÄÂßãÂèçÊé®ÊåâÈíÆÔºà‰ªÖÂõæÂÉèÂèçÊé®ÂíåÁºñËæëÊ®°ÂºèÊòæÁ§∫Ôºâ -->
                <button x-show="modelMode === 'tagging' || modelMode === 'editing'" @click="startBatchTag()" :disabled="selectedCount === 0 && selectedPairCount === 0" class="w-full px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                    ‚ú® ÂºÄÂßãÂèçÊé®
                </button>
            </div>
        </div>

        <!-- Âè≥‰æß‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="flex-1 flex flex-col">
            
            <!-- È°∂ÈÉ®ÔºöÊ®°ÂûãÊ®°ÂºèÈÄâÊã© -->
            <div class="bg-white border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <span class="text-sm font-medium text-gray-700">Ê®°ÂûãÊ®°Âºè:</span>
                        <button @click="modelMode = 'tagging'" :class="modelMode === 'tagging' ? 'bg-violet-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'" class="px-4 py-2 text-sm rounded-lg transition-colors font-medium">
                            üè∑Ô∏è ÂõæÂÉèÂèçÊé®Ê®°Âûã
                        </button>
                        <button @click="modelMode = 'editing'" :class="modelMode === 'editing' ? 'bg-violet-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'" class="px-4 py-2 text-sm rounded-lg transition-colors font-medium">
                            üé® ÂõæÂÉèÁºñËæëÊ®°Âûã
                        </button>
                        <button @click="modelMode = 'analyzer'; loadPendingLogs(); loadAnalyzerRecords()" :class="modelMode === 'analyzer' ? 'bg-violet-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'" class="px-4 py-2 text-sm rounded-lg transition-colors font-medium">
                            üìä ËÆ≠ÁªÉÂàÜÊûêÂô®
                        </button>
                        <button @click="modelMode = 'chat'" :class="modelMode === 'chat' ? 'bg-violet-600 text-white' : 'bg-gray-100 text-gray-700 hover:bg-gray-200'" class="px-4 py-2 text-sm rounded-lg transition-colors font-medium">
                            üí¨ AI ÂØπËØù
                        </button>
                    </div>
                    
                    <div class="flex items-center space-x-2">
                        <button @click="showSettingsModal = true" class="p-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
            <div x-show="modelMode !== 'chat'" class="flex-1 overflow-y-auto p-6 bg-gray-50">
                
                <!-- ==================== ÂõæÂÉèÂèçÊé®ÔºàÂçïÂõæÔºâ ==================== -->

                <!-- ÊâπÈáèÊìç‰ΩúÂ∑•ÂÖ∑Ê†è -->
                <div x-show="modelMode === 'tagging' && images.length > 0" class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-4">
                    <div class="flex items-center justify-between flex-wrap gap-3">
                        <!-- Â∑¶‰æßÂ∑•ÂÖ∑ -->
                        <div class="flex items-center space-x-2 flex-wrap">
                            <button @click="selectAll()" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
                                ‚òë ÂÖ®ÈÄâ
                            </button>
                            <button @click="showRenameDialog = true" :disabled="selectedCount === 0" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                üîÑ ÈáçÂëΩÂêç
                            </button>
                            <button @click="showResizeDialog = true" :disabled="selectedCount === 0" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                ‚úÇ Ë£ÅÂàá
                            </button>
                            <button @click="showAddTextDialog = true" :disabled="selectedCount === 0" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                üìù Ê∑ªÂä†ÊñáÊú¨
                            </button>
                            <button @click="clearSelectedText()" :disabled="selectedCount === 0" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                üóë Ê∏ÖÁ©∫ÊñáÊú¨
                            </button>
                            <div class="h-6 w-px bg-gray-300"></div>
                            <button @click="batchTag()" :disabled="selectedCount === 0 || isProcessing" class="px-4 py-2 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium">
                                <span x-show="!isProcessing">‚ú® ÂºÄÂßãÂèçÊé®</span>
                                <span x-show="isProcessing">‚è≥ Â§ÑÁêÜ‰∏≠...</span>
                            </button>
                            <button @click="exportDataset()" :disabled="selectedCount === 0" class="px-4 py-2 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium">
                                ‚¨áÔ∏è ÂØºÂá∫Êï∞ÊçÆÈõÜ
                            </button>
                        </div>

                        <!-- Âè≥‰æßÂà†Èô§ÊåâÈíÆ -->
                        <button @click="deleteSelected()" :disabled="selectedCount === 0" class="px-4 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium flex items-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                            <span>Âà†Èô§ÈÄâ‰∏≠</span>
                        </button>
                    </div>

                    <!-- ËøõÂ∫¶Êù° -->
                    <div x-show="isProcessing" class="mt-3">
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" :style="`width: ${progress}%`"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1" x-text="`Â§ÑÁêÜ‰∏≠: ${taskStatus.completed || 0} / ${taskStatus.total || 0}`"></p>
                        <p class="text-xs text-gray-500 mt-1" x-text="`Â§±Ë¥•: ${taskStatus.failed || 0}`"></p>
                        <p class="text-xs text-gray-500 mt-1" x-show="taskStatus.current_name" x-text="`Ê≠£Âú®ÂèçÊé®: ${taskStatus.current_index || 0}/${taskStatus.total || 0}  ${taskStatus.current_name}`"></p>
                        <div class="mt-2">
                            <button @click="cancelCurrentTask()" :disabled="!currentTaskId" class="px-3 py-1.5 text-xs bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">ÂèñÊ∂à</button>
                        </div>
                    </div>
                </div>

                <!-- ÂõæÁâáÁΩëÊ†ºÔºàÁÄëÂ∏ÉÊµÅÔºâ -->
                <div x-show="modelMode === 'tagging'" class="grid grid-cols-4 gap-4">
                    <template x-for="image in images" :key="image.id">
                        <div 
                            x-transition:enter="transition ease-out duration-300"
                            x-transition:enter-start="opacity-0 scale-90"
                            x-transition:enter-end="opacity-100 scale-100"
                            x-transition:leave="transition ease-in duration-200"
                            x-transition:leave-start="opacity-100 scale-100"
                            x-transition:leave-end="opacity-0 scale-90"
                            class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden"
                        >
                            <!-- ÂõæÁâáÂå∫ÂüüÔºàÊåâÂéüÂõæÂÆΩÈ´òÊØîÈì∫Êª°Ôºâ -->
                            <div
                                @click="openDetail(image.id)"
                                class="relative group cursor-pointer bg-gray-100"
                                :style="`aspect-ratio: ${image.width}/${image.height};`"
                            >
                                <img
                                    x-show="image.thumbnail"
                                    :src="image.thumbnail"
                                    :alt="image.name"
                                    class="absolute inset-0 w-full h-full object-cover"
                                    style="display: block;"
                                >

                                <!-- Âä†ËΩΩ‰∏≠ÊàñÊó†Áº©Áï•ÂõæÊèêÁ§∫ -->
                                <div x-show="!image.thumbnail" class="absolute inset-0 flex flex-col items-center justify-center text-gray-400">
                                    <svg class="w-12 h-12 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                    </svg>
                                    <span class="text-sm">Âä†ËΩΩ‰∏≠...</span>
                                </div>

                                <!-- Â∞∫ÂØ∏ÔºöÂ∑¶‰∏äËßíÂè†Âä† -->
                                <div class="absolute top-2 left-2 px-2 py-1 rounded-md bg-black/60 text-white text-xs font-medium" x-text="`${image.width}x${image.height}`"></div>

                                <!-- ÂãæÈÄâÊ°ÜÔºöÂè≥‰∏äËßíÂè†Âä†ÔºàÈÅøÂÖçÂíåÂ∞∫ÂØ∏ÈáçÂè†Ôºâ -->
                                <div class="absolute top-2 right-2 z-10">
                                    <input type="checkbox" :checked="image.selected" @click.stop="toggleSelect(image.id)" class="w-5 h-5 text-purple-600 rounded focus:ring-purple-500 bg-white/90 border-gray-300 cursor-pointer">
                                </div>

                                <!-- ÊÇ¨ÂÅúÊïàÊûú -->
                                <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-20 transition-all flex items-center justify-center">
                                    <svg class="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"></path>
                                    </svg>
                                </div>

                                <div x-show="isProcessing && taskStatus.type === 'images' && taskStatus.current_id === image.id" class="absolute inset-0 bg-black/30 flex items-center justify-center">
                                    <svg class="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                    </svg>
                                </div>
                            </div>

                            <!-- ÊñáÊú¨È¢ÑËßàÂå∫ÂüüÔºàÂõæÁâá‰∏ãÊñπÔºâ -->
                            <div class="p-3 bg-white">
                                <p class="text-sm text-gray-700 line-clamp-3 mb-2" x-text="image.text || '(Êó†ÊñáÊú¨)'"></p>
                                <div class="flex items-center justify-between gap-2">
                                    <p class="text-xs text-gray-400 truncate" x-text="image.name"></p>
                                    <div class="flex items-center space-x-2 shrink-0">
                                        <span x-show="image.status === 'success'" class="text-green-500 text-xs">‚úÖ</span>
                                        <span x-show="isProcessing && taskStatus.type === 'images' && taskStatus.current_id === image.id" class="text-blue-500">
                                            <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                            </svg>
                                        </span>
                                        <span x-show="image.status === 'error'" class="text-red-500 text-xs">‚ùå</span>
                                        <span x-show="image.status === 'idle'" class="text-gray-400 text-xs">‚ö™</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>

                    <!-- ‰∏ä‰º†ÂõæÁâáÁ©∫Ê°ÜÂç°Áâá -->
                    <div 
                        @click="selectImages()"
                        class="bg-white rounded-xl border-2 border-dashed border-gray-300 hover:border-purple-500 hover:bg-purple-50 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center group min-h-[300px]"
                    >
                        <div class="p-6 flex flex-col items-center text-gray-400 group-hover:text-purple-600">
                            <svg class="w-16 h-16 mb-4 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            <span class="text-sm font-medium">ÁÇπÂáªÊ∑ªÂä†ÂõæÁâá</span>
                            <span class="text-xs mt-1 text-gray-400">ÊîØÊåÅÂ§öÈÄâ</span>
                        </div>
                    </div>
                </div>

                <!-- ==================== ÂõæÂÉèÁºñËæëÔºàÊàêÂØπÔºâ ==================== -->

                <div x-show="modelMode === 'editing'" class="space-y-4">
                    <!-- ÁºñËæëÊ®°ÂºèÂ∑•ÂÖ∑Ê†è -->
                    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
                        <div class="flex items-center justify-between flex-wrap gap-3">
                            <div class="flex items-center space-x-2 flex-wrap gap-y-2">
                                <button @click="selectAllPairs()" class="px-3 py-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors flex items-center space-x-1">
                                    <input type="checkbox" :checked="pairs.length > 0 && selectedPairCount === pairs.length" class="w-4 h-4 text-violet-600 rounded pointer-events-none">
                                    <span>ÂÖ®ÈÄâ</span>
                                </button>
                                <button @click="selectPairFolder()" class="px-3 py-2 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors">
                                    üìÇ ÂØºÂÖ•Êï∞ÊçÆÈõÜ
                                </button>
                                <button @click="batchTagPairs()" :disabled="selectedPairCount === 0 || isProcessing" class="px-3 py-2 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span x-show="!isProcessing">‚ú® ‰∏ÄÈîÆÂèçÊé®</span>
                                    <span x-show="isProcessing">‚è≥ Â§ÑÁêÜ‰∏≠...</span>
                                </button>
                                <button @click="openExportDialog()" :disabled="selectedPairCount === 0" class="px-3 py-2 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    ‚¨áÔ∏è ÂØºÂá∫
                                </button>
                                <span x-show="selectedPairCount > 0" x-transition class="px-3 py-2 text-sm bg-violet-100 text-violet-700 rounded-lg font-medium">
                                    <span x-text="selectedPairCount"></span> / <span x-text="pairs.length"></span> ÁªÑ
                                </span>
                            </div>
                            <button x-show="selectedPairCount > 0" x-transition @click="deleteSelectedPairs()" class="px-3 py-2 text-sm bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                üóë Âà†Èô§ÈÄâ‰∏≠
                            </button>
                        </div>

                        <!-- ÊâπÈáèÊñáÊú¨Êìç‰ΩúÊ†è - ÈÄâ‰∏≠Êó∂ÊòæÁ§∫ -->
                        <div x-show="selectedPairCount > 0" x-transition class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <div class="flex items-center flex-wrap gap-3">
                                <div class="flex items-center space-x-2">
                                    <label class="text-xs text-gray-600 whitespace-nowrap">Êìç‰ΩúÁ±ªÂûã</label>
                                    <select x-model="batchTextAction" class="px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500">
                                        <option value="append">ÊâπÈáèÊ∑ªÂä†ÊñáÊú¨</option>
                                        <option value="clear">ÊâπÈáèÊ∏ÖÁ©∫ÊñáÊú¨</option>
                                    </select>
                                </div>
                                <div x-show="batchTextAction === 'append'" class="flex items-center space-x-2">
                                    <label class="text-xs text-gray-600 whitespace-nowrap">Ê∑ªÂä†‰ΩçÁΩÆ</label>
                                    <select x-model="batchTextPosition" class="px-2 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500">
                                        <option value="prefix">ÊèêÁ§∫ËØçÂè•È¶ñ</option>
                                        <option value="suffix">ÊèêÁ§∫ËØçÂè•Â∞æ</option>
                                    </select>
                                </div>
                                <div x-show="batchTextAction === 'append'" class="flex-1 min-w-[200px]">
                                    <input type="text" x-model="batchTextValue" placeholder="ËØ∑ËæìÂÖ•ÊñáÊú¨" class="w-full px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-violet-500">
                                </div>
                                <button @click="applyBatchText()" class="px-4 py-1.5 text-sm bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors whitespace-nowrap">
                                    ‚úÖ Â∫îÁî®Âà∞ÈÄâ‰∏≠
                                </button>
                            </div>
                        </div>

                        <!-- ÂØºÂÖ•ËøõÂ∫¶Êù° -->
                        <div x-show="isImporting" class="mt-3">
                            <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="bg-violet-600 h-2 rounded-full animate-pulse" style="width: 100%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1" x-text="importProgressText"></p>
                        </div>

                        <!-- ÊâπÈáèÂ§ÑÁêÜËøõÂ∫¶Êù° -->
                        <div x-show="isProcessing" class="mt-3">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-purple-600 h-2 rounded-full transition-all duration-300" :style="`width: ${progress}%`"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1" x-text="`Â§ÑÁêÜ‰∏≠: ${taskStatus.completed || 0} / ${taskStatus.total || 0}`"></p>
                            <p class="text-xs text-gray-500 mt-1" x-text="`Â§±Ë¥•: ${taskStatus.failed || 0}`"></p>
                            <p class="text-xs text-gray-500 mt-1" x-show="taskStatus.current_name" x-text="`Ê≠£Âú®ÂèçÊé®: ${taskStatus.current_index || 0}/${taskStatus.total || 0}  ${taskStatus.current_name}`"></p>
                            <div class="mt-2">
                                <button @click="cancelCurrentTask()" :disabled="!currentTaskId" class="px-3 py-1.5 text-xs bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">ÂèñÊ∂à</button>
                            </div>
                        </div>
                    </div>

                    <!-- ÊàêÂØπÂõæÁâáÁΩëÊ†ºÔºöÊØèÁªÑ‰∏Ä‰∏™Âç°Áâá -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                        <template x-for="pair in pairs" :key="pair.id">
                            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-2 relative group">
                                <!-- Â∑¶‰∏äËßíÂ§çÈÄâÊ°Ü - z-20Á°Æ‰øùÂú®ÊÇ¨ÂÅúÈÅÆÁΩ©‰πã‰∏ä -->
                                <div class="absolute top-1 left-1 z-20">
                                    <input type="checkbox" :checked="pair.selected" @click.stop="togglePairSelect(pair.id)" class="w-4 h-4 text-violet-600 rounded focus:ring-violet-500 border-gray-300 cursor-pointer bg-white/90">
                                </div>

                                <!-- Âè≥‰∏äËßíÂà†Èô§ÊåâÈíÆ - ÊÇ¨ÂÅúÊòæÁ§∫ -->
                                <button @click.stop="deleteSinglePair(pair.id)" class="absolute top-1 right-1 z-20 w-5 h-5 bg-red-500 hover:bg-red-600 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-xs font-bold shadow-sm">
                                    ‚úï
                                </button>

                                <!-- ÊÇ¨ÂÅúÊó∂ÊòæÁ§∫ÁöÑÁºñËæëÊåâÈíÆ -->
                                <div class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center z-10 rounded-lg">
                                    <button @click="openPairDetail(pair.id)" class="px-4 py-2 text-sm bg-white text-gray-800 rounded-lg hover:bg-gray-100 transition-colors font-medium">
                                        üìù ÁºñËæë
                                    </button>
                                </div>

                                <div x-show="isProcessing && taskStatus.type === 'pairs' && taskStatus.current_id === pair.id" class="absolute inset-0 bg-black/30 flex items-center justify-center z-20 rounded-lg">
                                    <svg class="animate-spin h-6 w-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                    </svg>
                                </div>

                                <!-- ÂõæÁâáÈ¢ÑËßàÂå∫ÂüüÔºö‰∏§Âº†Áã¨Á´ãÁöÑÊ≠£ÊñπÂΩ¢ÂõæÁâá -->
                                <div class="flex gap-1">
                                    <!-- ÂõæÁâá1 - Áã¨Á´ãÊ≠£ÊñπÂΩ¢Ê°Ü -->
                                    <div class="flex-1">
                                        <div class="relative aspect-square bg-gray-100 rounded overflow-hidden">
                                            <img x-show="pair.left && pair.left.thumbnail" :src="pair.left.thumbnail" class="absolute inset-0 w-full h-full object-cover">
                                            <div x-show="!pair.left" class="absolute inset-0 flex items-center justify-center text-gray-400 text-xs">ÂéüÂõæ</div>
                                        </div>
                                    </div>
                                    <!-- ÁõÆÊ†áÂõæ - Áã¨Á´ãÊ≠£ÊñπÂΩ¢Ê°Ü -->
                                    <div class="flex-1">
                                        <div class="relative aspect-square bg-gray-100 rounded overflow-hidden">
                                            <img x-show="pair.right && pair.right.thumbnail" :src="pair.right.thumbnail" class="absolute inset-0 w-full h-full object-cover">
                                            <div x-show="!pair.right" class="absolute inset-0 flex items-center justify-center text-gray-400 text-xs">ÁõÆÊ†á</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Â∫ïÈÉ®ÊèêÁ§∫ËØçÈ¢ÑËßà -->
                                <div class="mt-2 pt-2 border-t border-gray-100">
                                    <div class="flex items-center gap-1">
                                        <p class="text-xs text-gray-500 line-clamp-1 flex-1" x-text="pair.text || 'ÊöÇÊó†ÊèêÁ§∫ËØç'"></p>
                                        <span x-show="pair.status === 'success'" class="text-green-500 text-xs shrink-0">‚úÖ</span>
                                        <span x-show="pair.status === 'error'" class="text-red-500 text-xs shrink-0">‚ùå</span>
                                        <span x-show="pair.status === 'idle' && !(isProcessing && taskStatus.type === 'pairs' && taskStatus.current_id === pair.id)" class="text-gray-400 text-xs shrink-0">‚ö™</span>
                                        <span x-show="isProcessing && taskStatus.type === 'pairs' && taskStatus.current_id === pair.id" class="text-blue-500 shrink-0">
                                            <svg class="animate-spin h-3 w-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Ê∑ªÂä†ÁªÑÂç°Áâá -->
                        <div @click="openAddPairModal()" class="bg-white rounded-lg border-2 border-dashed border-gray-300 hover:border-violet-500 hover:bg-violet-50 transition-all duration-300 cursor-pointer flex flex-col items-center justify-center group min-h-[120px]">
                            <div class="p-2 flex flex-col items-center text-gray-400 group-hover:text-violet-600">
                                <svg class="w-10 h-10 mb-1 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                <span class="text-xs font-medium">Ê∑ªÂä†ÊàêÂØπÁªÑ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ==================== ËÆ≠ÁªÉÂàÜÊûêÂô® ==================== -->
                <div x-show="modelMode === 'analyzer'" class="space-y-4">
                    <!-- APIÈÖçÁΩÆÂå∫ÂüüÔºàÂÜÖÂµåÂú®ËÆ≠ÁªÉÂàÜÊûêÂô®È°µÈù¢Ôºâ -->
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-4 mb-4">
                        <div class="flex items-center space-x-6">
                            <div class="flex items-center space-x-3">
                                <label class="text-sm font-medium text-gray-700 whitespace-nowrap">API Ê∏†ÈÅì:</label>
                                <select x-model="apikeyConfig.current_provider" @change="onProviderChange()" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm min-w-[160px]">
                                    <template x-for="(provider, key) in apikeyConfig.providers" :key="key">
                                        <option :value="key" x-text="providerNames[key]"></option>
                                    </template>
                                </select>
                            </div>
                            <div class="flex items-center space-x-3">
                                <label class="text-sm font-medium text-gray-700 whitespace-nowrap">ÈÄâÊã©Ê®°Âûã:</label>
                                <select x-model="apikeyConfig.model" @change="saveApikeyConfig(true)" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent text-sm min-w-[240px]">
                                    <template x-for="model in getCurrentProviderModels()" :key="model.id">
                                        <option :value="model.id" x-text="model.name"></option>
                                    </template>
                                </select>
                            </div>
                            <button @click="showSettingsModal = true" class="px-3 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors text-sm flex items-center space-x-1">
                                <span>‚öôÔ∏è</span>
                                <span>Êõ¥Â§öËÆæÁΩÆ</span>
                            </button>
                        </div>
                    </div>

                    <!-- Â≠êÊ†áÁ≠æÈ°µ -->
                    <div class="flex space-x-2 mb-4">
                        <button @click="analyzerSubTab = 'pending'; loadPendingLogs()" :class="analyzerSubTab === 'pending' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 border border-gray-300'" class="px-4 py-2 rounded-lg font-medium transition-colors">
                            üìÅ ÂæÖÂàÜÊûê
                        </button>
                        <button @click="analyzerSubTab = 'curve'" :class="analyzerSubTab === 'curve' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 border border-gray-300'" class="px-4 py-2 rounded-lg font-medium transition-colors">
                            üìà ËÆ≠ÁªÉÊõ≤Á∫ø
                        </button>
                        <button @click="analyzerSubTab = 'history'" :class="analyzerSubTab === 'history' ? 'bg-green-600 text-white' : 'bg-white text-gray-700 border border-gray-300'" class="px-4 py-2 rounded-lg font-medium transition-colors">
                            üìö ÂéÜÂè≤ËÆ∞ÂΩï
                        </button>
                    </div>

                    <!-- ÂæÖÂàÜÊûêÊñá‰ª∂Ê†áÁ≠æÈ°µ -->
                    <div x-show="analyzerSubTab === 'pending'" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-green-700">üìÅ ÂæÖÂàÜÊûêÊó•ÂøóÊñá‰ª∂</h3>
                            <div class="flex space-x-2">
                                <button @click="loadPendingLogs()" class="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm">
                                    üîÑ Âà∑Êñ∞
                                </button>
                                <button @click="analyzeAllPending()" :disabled="pendingLogs.length === 0" class="px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm disabled:opacity-50 disabled:cursor-not-allowed">
                                    ‚ú® ÂàÜÊûêÂÖ®ÈÉ®
                                </button>
                            </div>
                        </div>
                        
                        <!-- ÊãñÊãΩ‰∏ä‰º†Âå∫Âüü -->
                        <div 
                            @dragover="handleDragOver($event)"
                            @dragleave="handleDragLeave($event)"
                            @drop="handleDrop($event)"
                            :class="isDragOver ? 'border-green-500 bg-green-50' : 'border-gray-300 bg-gray-50'"
                            class="border-2 border-dashed rounded-xl p-8 mb-4 text-center transition-colors cursor-pointer"
                            @click="browseLogFile().then(() => analyzerLogPath && addLogFromPath(analyzerLogPath))"
                        >
                            <div class="text-4xl mb-2">üìÇ</div>
                            <p class="text-gray-600 font-medium">ÊãñÊãΩÊó•ÂøóÊñá‰ª∂Âà∞Ê≠§Â§Ñ‰∏ä‰º†</p>
                            <p class="text-gray-400 text-sm mt-1">ÊàñÁÇπÂáªÈÄâÊã©Êñá‰ª∂ ¬∑ ÊîØÊåÅ .txt / .log Ê†ºÂºè</p>
                        </div>
                        
                        <!-- ÂæÖÂàÜÊûêÊñá‰ª∂ÂàóË°® -->
                        <template x-if="pendingLogs.length > 0">
                            <div class="space-y-2">
                                <template x-for="log in pendingLogs" :key="log.path">
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors">
                                        <div class="flex items-center space-x-3">
                                            <span class="text-2xl">üìÑ</span>
                                            <div>
                                                <p class="font-medium text-gray-800" x-text="log.name"></p>
                                                <p class="text-xs text-gray-500" x-text="formatFileSize(log.size)"></p>
                                            </div>
                                        </div>
                                        <div class="flex space-x-2">
                                            <button @click="analyzeAndMove(log.path)" class="px-3 py-1.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
                                                üîç ÂàÜÊûê
                                            </button>
                                            <button @click="deletePendingLog(log.path)" class="px-3 py-1.5 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm">
                                                üóëÔ∏è
                                            </button>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </template>
                        
                        <template x-if="pendingLogs.length === 0">
                            <div class="text-center text-gray-400 py-8">
                                <p>ÊöÇÊó†ÂæÖÂàÜÊûêÁöÑÊó•ÂøóÊñá‰ª∂</p>
                                <p class="text-sm mt-1">ÊãñÊãΩÊàñÁÇπÂáª‰∏äÊñπÂå∫ÂüüÊ∑ªÂä†Êñá‰ª∂</p>
                            </div>
                        </template>
                    </div>

                    <!-- ËÆ≠ÁªÉÊõ≤Á∫øÊ†áÁ≠æÈ°µ -->
                    <div x-show="analyzerSubTab === 'curve'" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 max-h-[calc(100vh-200px)] overflow-y-auto">
                        <!-- ÂØπÊØîÊ®°ÂºèÊèêÁ§∫ -->
                        <template x-if="compareMode">
                            <div class="mb-4 p-3 bg-violet-50 border border-violet-200 rounded-lg flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-violet-600">üìä</span>
                                    <span class="text-violet-700 font-medium">ÂØπÊØîÊ®°ÂºèÔºöÊ≠£Âú®ÂØπÊØî <span x-text="compareData.length"></span> Êù°ËÆ≠ÁªÉËÆ∞ÂΩï</span>
                                </div>
                                <button @click="exitCompareMode()" class="px-3 py-1 bg-violet-600 text-white text-sm rounded-lg hover:bg-violet-700 transition-colors">
                                    ÈÄÄÂá∫ÂØπÊØî
                                </button>
                            </div>
                        </template>

                        <template x-if="!analyzerResult && !compareMode">
                            <div class="h-64 flex items-center justify-center text-gray-400">
                                <div class="text-center">
                                    <svg class="w-16 h-16 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <p>ËØ∑ÂÖàÂú®"ÂæÖÂàÜÊûê"Ê†áÁ≠æÈ°µÈÄâÊã©Êó•ÂøóÊñá‰ª∂ËøõË°åÂàÜÊûê</p>
                                    <p class="text-sm mt-2">ÊàñÂú®"ÂéÜÂè≤ËÆ∞ÂΩï"‰∏≠ÂãæÈÄâÂ§öÊù°ËÆ∞ÂΩïËøõË°åÂØπÊØî</p>
                                </div>
                            </div>
                        </template>
                        <template x-if="analyzerResult || compareMode">
                            <div>
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-lg font-bold text-green-700" x-text="compareMode ? 'ËÆ≠ÁªÉÊõ≤Á∫øÂØπÊØî' : 'ËÆ≠ÁªÉÊõ≤Á∫ø - Epoch vs Val Loss'"></h3>
                                    <template x-if="analyzerResult.training_sessions && analyzerResult.training_sessions.length > 1">
                                        <div class="flex items-center space-x-2">
                                            <label class="text-sm text-gray-600">ÈÄâÊã©ËÆ≠ÁªÉ:</label>
                                            <select x-model="currentSessionIndex" @change="updateCharts()" class="px-3 py-1 border border-gray-300 rounded-lg">
                                                <template x-for="(session, idx) in analyzerResult.training_sessions" :key="idx">
                                                    <option :value="idx" x-text="'ËÆ≠ÁªÉ ' + (idx+1) + ' - ' + (session.config?.model_name || 'Êú™Áü•')"></option>
                                                </template>
                                            </select>
                                        </div>
                                    </template>
                                </div>
                                <div class="h-80">
                                    <canvas id="trainingCurveChart"></canvas>
                                </div>
                                
                                <!-- ÂØπÊØîÊ®°Âºè‰∏ãÊòæÁ§∫ÂØπÊØîÁªüËÆ° -->
                                <template x-if="compareMode">
                                    <div class="mt-4 p-4 bg-violet-50 rounded-lg border border-violet-200">
                                        <h4 class="font-bold text-violet-700 mb-3">üìä ÂØπÊØîÁªüËÆ°</h4>
                                        <div class="grid gap-3">
                                            <template x-for="(record, idx) in compareData" :key="idx">
                                                <div class="flex items-center justify-between p-2 bg-white rounded-lg border border-violet-100">
                                                    <span class="font-medium text-gray-700" x-text="record.model_name"></span>
                                                    <div class="flex items-center space-x-4 text-sm">
                                                        <span class="text-gray-500">ÊúÄ‰Ω≥Loss: <span class="font-bold text-green-600" x-text="(record.best_val_loss || record.statistics?.min_loss)?.toFixed(6) || 'N/A'"></span></span>
                                                        <span class="text-gray-500">Epoch: <span class="font-bold" x-text="record.best_epoch || record.statistics?.best_epoch || 'N/A'"></span></span>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>
                                </template>

                                <!-- ÁªüËÆ°‰ø°ÊÅØÔºàÈùûÂØπÊØîÊ®°ÂºèÔºâ -->
                                <div x-show="!compareMode" class="mt-4 p-4 bg-green-50 rounded-lg border border-green-200">
                                    <h4 class="font-bold text-green-700 mb-2">ÁªüËÆ°‰ø°ÊÅØ</h4>
                                    <div class="grid grid-cols-4 gap-4 text-sm">
                                        <div><span class="text-gray-600">ÊÄªEpochÊï∞:</span> <span class="font-bold" x-text="currentStats.total_epochs"></span></div>
                                        <div><span class="text-gray-600">ÊúÄÂ∞èLoss:</span> <span class="font-bold text-green-600" x-text="currentStats.min_loss?.toFixed(6) + ' (Epoch ' + currentStats.best_epoch + ')'"></span></div>
                                        <div><span class="text-gray-600">ÊúÄÂ§ßLoss:</span> <span class="font-bold" x-text="currentStats.max_loss?.toFixed(6)"></span></div>
                                        <div><span class="text-gray-600">Âπ≥ÂùáLoss:</span> <span class="font-bold" x-text="currentStats.avg_loss?.toFixed(6)"></span></div>
                                    </div>
                                </div>
                                
                                <!-- AIÂª∫ËÆÆÂå∫ÂüüÔºàÊï¥ÂêàÂà∞ËÆ≠ÁªÉÊõ≤Á∫øÈ°µÈù¢ÔºåÈùûÂØπÊØîÊ®°ÂºèÔºâ -->
                                <div x-show="!compareMode" class="mt-6 border-t border-gray-200 pt-6">
                                    <div class="flex items-center justify-between mb-4">
                                        <h4 class="font-bold text-green-700 flex items-center space-x-2">
                                            <span>ü§ñ</span>
                                            <span>AI ËÆ≠ÁªÉÂàÜÊûê‰∏é‰ºòÂåñÂª∫ËÆÆ</span>
                                        </h4>
                                        <button @click="aiAnalyzeTraining()" :disabled="isAiAnalyzing" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2">
                                            <template x-if="isAiAnalyzing">
                                                <svg class="animate-spin h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                            </template>
                                            <span x-text="isAiAnalyzing ? 'ÂàÜÊûê‰∏≠...' : 'üîç AIÂàÜÊûê'"></span>
                                        </button>
                                    </div>
                                    
                                    <template x-if="!aiAnalysisResult && !isAiAnalyzing">
                                        <div class="p-6 bg-gray-50 rounded-lg text-center text-gray-400">
                                            <span class="text-2xl mb-2 block">‚ú®</span>
                                            <p>ÁÇπÂáª"AIÂàÜÊûê"ÊåâÈíÆÔºåËé∑Âèñ‰∏ì‰∏öÁöÑËÆ≠ÁªÉ‰ºòÂåñÂª∫ËÆÆ</p>
                                        </div>
                                    </template>
                                    
                                    <template x-if="isAiAnalyzing">
                                        <div class="p-6 bg-gray-50 rounded-lg text-center">
                                            <div class="flex justify-center mb-3">
                                                <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce mx-1" style="animation-delay: 0ms;"></div>
                                                <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce mx-1" style="animation-delay: 150ms;"></div>
                                                <div class="w-2 h-2 bg-green-500 rounded-full animate-bounce mx-1" style="animation-delay: 300ms;"></div>
                                            </div>
                                            <p class="text-gray-600 text-sm">AI Ê≠£Âú®ÂàÜÊûêËÆ≠ÁªÉÊï∞ÊçÆ...</p>
                                        </div>
                                    </template>
                                    
                                    <template x-if="aiAnalysisResult">
                                        <div class="prose prose-green max-w-none select-text">
                                            <div class="bg-green-50 border border-green-200 rounded-lg p-4 select-text cursor-text" x-html="marked.parse(aiAnalysisResult)"></div>
                                        </div>
                                    </template>
                                </div>
                                
                                <!-- Top10 ÂàÜÊûêÂå∫ÂüüÔºàÊï¥ÂêàÂà∞ËÆ≠ÁªÉÊõ≤Á∫øÈ°µÈù¢ÔºåÈùûÂØπÊØîÊ®°ÂºèÔºâ -->
                                <div x-show="!compareMode" class="mt-6 border-t border-gray-200 pt-6">
                                    <h4 class="font-bold text-green-700 mb-4">üèÜ Ââç10‰∏™ÊúÄ‰ºòEpochÂàÜÊûê</h4>
                                    <div class="h-64 mb-4">
                                        <canvas id="top10Chart"></canvas>
                                    </div>
                                    <table class="w-full border-collapse text-sm">
                                        <thead>
                                            <tr class="bg-green-50">
                                                <th class="border border-gray-200 px-3 py-2 text-left">ÊéíÂêç</th>
                                                <th class="border border-gray-200 px-3 py-2 text-left">Epoch</th>
                                                <th class="border border-gray-200 px-3 py-2 text-left">Val Loss</th>
                                                <th class="border border-gray-200 px-3 py-2 text-left">Áõ∏ÂØπÊúÄ‰Ω≥</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="(item, idx) in currentStats.top_10" :key="idx">
                                                <tr :class="idx === 0 ? 'bg-green-100' : ''">
                                                    <td class="border border-gray-200 px-3 py-2" x-text="idx + 1"></td>
                                                    <td class="border border-gray-200 px-3 py-2" x-text="item.epoch"></td>
                                                    <td class="border border-gray-200 px-3 py-2" x-text="item.val_loss.toFixed(10)"></td>
                                                    <td class="border border-gray-200 px-3 py-2" x-text="idx === 0 ? '0.000000' : '+' + (item.val_loss - currentStats.top_10[0].val_loss).toFixed(6)"></td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÊ†áÁ≠æÈ°µ -->
                    <div x-show="analyzerSubTab === 'history'" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-bold text-green-700">ËÆ≠ÁªÉÊä•Âëä - ÂéÜÂè≤ËÆ∞ÂΩï</h3>
                            <div class="flex items-center space-x-2">
                                <template x-if="compareRecordIds.length >= 2">
                                    <button @click="compareRecords()" class="px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors">
                                        üìä ÂØπÊØîÊõ≤Á∫ø (<span x-text="compareRecordIds.length"></span>)
                                    </button>
                                </template>
                                <template x-if="compareRecordIds.length > 0 && compareRecordIds.length < 2">
                                    <span class="text-sm text-gray-500">ËØ∑Ëá≥Â∞ëÈÄâÊã©2Êù°ËÆ∞ÂΩïËøõË°åÂØπÊØî</span>
                                </template>
                                <button @click="loadAnalyzerRecords()" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors">
                                    üîÑ Âà∑Êñ∞
                                </button>
                            </div>
                        </div>
                        <table class="w-full border-collapse">
                            <thead>
                                <tr class="bg-green-50">
                                    <th class="border border-gray-200 px-3 py-2 text-center w-12">
                                        <span class="text-xs text-gray-500">ÂØπÊØî</span>
                                    </th>
                                    <th class="border border-gray-200 px-4 py-2 text-left">Ê®°ÂûãÂêçÁß∞</th>
                                    <th class="border border-gray-200 px-4 py-2 text-left">ÂàÜÊûêÊó∂Èó¥</th>
                                    <th class="border border-gray-200 px-4 py-2 text-left">ÊúÄ‰Ω≥Loss</th>
                                    <th class="border border-gray-200 px-4 py-2 text-left">EpochÊï∞</th>
                                    <th class="border border-gray-200 px-4 py-2 text-left">ÊúÄ‰Ω≥Epoch</th>
                                    <th class="border border-gray-200 px-4 py-2 text-left">Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="record in analyzerRecords" :key="record.id">
                                    <tr class="hover:bg-gray-50" :class="compareRecordIds.includes(record.id) ? 'bg-violet-50' : ''">
                                        <td class="border border-gray-200 px-3 py-2 text-center">
                                            <input type="checkbox" 
                                                   :checked="compareRecordIds.includes(record.id)"
                                                   @change="toggleCompareRecord(record.id)"
                                                   class="w-4 h-4 text-violet-600 rounded focus:ring-violet-500">
                                        </td>
                                        <td class="border border-gray-200 px-4 py-2" x-text="record.model_name"></td>
                                        <td class="border border-gray-200 px-4 py-2" x-text="record.analysis_date"></td>
                                        <td class="border border-gray-200 px-4 py-2" x-text="record.best_val_loss?.toFixed(6) || 'N/A'"></td>
                                        <td class="border border-gray-200 px-4 py-2" x-text="record.num_epochs || 'N/A'"></td>
                                        <td class="border border-gray-200 px-4 py-2" x-text="record.best_epoch"></td>
                                        <td class="border border-gray-200 px-4 py-2">
                                            <button @click="viewRecord(record.id)" class="px-2 py-1 bg-blue-500 text-white text-xs rounded hover:bg-blue-600 mr-1">ËØ¶ÊÉÖ</button>
                                            <button @click="deleteAnalyzerRecord(record.id)" class="px-2 py-1 bg-red-500 text-white text-xs rounded hover:bg-red-600">Âà†Èô§</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        <template x-if="analyzerRecords.length === 0">
                            <div class="text-center text-gray-400 py-8">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩï</div>
                        </template>
                    </div>
                </div>
            </div>

            <!-- ==================== Chat ÂØπËØùÊ®°Âºè ==================== -->
            <div x-show="modelMode === 'chat'" class="flex-1 overflow-hidden bg-gray-50">
                <div class="h-full flex flex-col p-4">
                    <div class="flex-1 bg-white rounded-xl shadow-sm border border-gray-200 flex flex-col overflow-hidden">
                        <!-- ËÅäÂ§©Â§¥ÈÉ® -->
                        <div class="px-4 py-3 border-b border-gray-200 bg-gradient-to-r from-violet-50 to-purple-50">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <span class="text-lg">üí¨</span>
                                    <h3 class="font-medium text-gray-800" x-text="getCurrentChatTitle()"></h3>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <button @click="clearCurrentChat()" class="px-3 py-1.5 text-xs bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg transition-colors">
                                        üóë Ê∏ÖÁ©∫ÂØπËØù
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ËÅäÂ§©Ê∂àÊÅØÂå∫Âüü -->
                        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatMessages" x-ref="chatMessages">
                            <template x-if="chatMessages.length === 0">
                                <div class="h-full flex items-center justify-center text-gray-400">
                                    <div class="text-center">
                                        <span class="text-4xl mb-4 block">üí¨</span>
                                        <p class="text-sm">ÂºÄÂßã‰∏é AI ÂØπËØùÂêßÔºÅ</p>
                                        <p class="text-xs mt-2 text-gray-300">‰ΩøÁî®Â∑¶‰æßÈÄâÊã©ÁöÑÊ®°ÂûãËøõË°åÂØπËØù</p>
                                    </div>
                                </div>
                            </template>
                            <template x-for="(msg, index) in chatMessages" :key="index">
                                <div :class="msg.role === 'user' ? 'flex justify-end' : 'flex justify-start'">
                                    <div :class="msg.role === 'user' ? 'bg-violet-600 text-white rounded-2xl rounded-br-md' : 'bg-gray-100 text-gray-800 rounded-2xl rounded-bl-md'" class="max-w-[80%] px-4 py-3 shadow-sm">
                                        <div class="text-sm whitespace-pre-wrap" x-text="msg.content"></div>
                                        <div :class="msg.role === 'user' ? 'text-violet-200' : 'text-gray-400'" class="text-xs mt-1" x-text="msg.time"></div>
                                    </div>
                                </div>
                            </template>
                            <!-- Âä†ËΩΩ‰∏≠ÊåáÁ§∫Âô® -->
                            <div x-show="isChatLoading" class="flex justify-start">
                                <div class="bg-gray-100 text-gray-800 rounded-2xl rounded-bl-md px-4 py-3 shadow-sm">
                                    <div class="flex items-center space-x-2">
                                        <div class="flex space-x-1">
                                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0ms;"></div>
                                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 150ms;"></div>
                                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 300ms;"></div>
                                        </div>
                                        <span class="text-xs text-gray-500">AI Ê≠£Âú®ÊÄùËÄÉ...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ËæìÂÖ•Âå∫Âüü -->
                        <div class="border-t border-gray-200 p-4 bg-gray-50">
                            <div class="flex space-x-3">
                                <textarea 
                                    x-model="chatInput" 
                                    @keydown.enter="handleChatEnter($event)"
                                    placeholder="ËæìÂÖ•Ê∂àÊÅØ... (Enter ÂèëÈÄÅ, Shift+Enter Êç¢Ë°å)"
                                    rows="2"
                                    class="flex-1 px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-violet-500 focus:border-transparent resize-none text-sm"
                                    :disabled="isChatLoading"
                                ></textarea>
                                <button 
                                    @click="sendChatMessage()" 
                                    :disabled="!chatInput.trim() || isChatLoading"
                                    class="px-6 py-3 bg-violet-600 text-white rounded-xl hover:bg-violet-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
                                >
                                    <span>ÂèëÈÄÅ</span>
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂØºÂá∫ÂØπËØùÊ°Ü -->
    <div x-show="showExportDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showExportDialog = false">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <div class="border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h2 class="text-lg font-bold text-gray-800">üì¶ ÂØºÂá∫ËÆ≠ÁªÉÊï∞ÊçÆÈõÜ</h2>
                <button @click="showExportDialog = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <!-- ÂØºÂá∫Á±ªÂûãÈÄâÊã© -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÂØºÂá∫Ê†ºÂºè</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportOutputType" value="zip" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">ZIP ÂéãÁº©ÂåÖ</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportOutputType" value="folder" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">Êñá‰ª∂Â§π</span>
                        </label>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" x-text="exportOutputType === 'zip' ? 'ÂéãÁº©ÂåÖÂêçÁß∞' : 'Êñá‰ª∂Â§πÂêçÁß∞'"></label>
                    <div class="flex items-center space-x-2">
                        <input type="text" x-model="exportFileName" placeholder="training_dataset" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-violet-500 focus:border-violet-500">
                        <span x-show="exportOutputType === 'zip'" class="text-sm text-gray-500">.zip</span>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÂØºÂá∫ÁõÆÂΩï</label>
                    <div class="flex space-x-2">
                        <input type="text" x-model="exportOutputDir" placeholder="ÈÄâÊã©ÂØºÂá∫ÁõÆÂΩïÊàñÁõ¥Êé•ËæìÂÖ•Ë∑ØÂæÑ..." class="flex-1 px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-violet-500 focus:border-violet-500">
                        <button @click="selectExportDir()" class="px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors text-sm">
                            üìÇ ÊµèËßà
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">‰∏çÈÄâÊã©ÂàôÂØºÂá∫Âà∞Á®ãÂ∫èÁõÆÂΩï</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÂõæÁâáÊ†ºÂºè</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportImageFormat" value="png" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">PNG (Êó†Êçü)</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportImageFormat" value="jpg" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">JPG (ÂéãÁº©)</span>
                        </label>
                    </div>
                </div>
                <!-- ÂëΩÂêçÊ®°ÂºèÈÄâÊã© -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÂëΩÂêçÊ®°Âºè</label>
                    <div class="flex flex-wrap gap-3">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportNamingMode" value="default" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">ÈªòËÆ§Ê®°Âºè</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportNamingMode" value="t2itrainer" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">T2itrainer</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="exportNamingMode" value="aitoolkit" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">AIToolkit</span>
                        </label>
                    </div>
                </div>
                <!-- T2itrainer ÂëΩÂêçËÆæÁΩÆ -->
                <div x-show="exportNamingMode === 't2itrainer'" x-transition class="space-y-3 bg-purple-50 rounded-lg p-3">
                    <div class="grid grid-cols-3 gap-2">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">ÂéüÂõæ1ÂêéÁºÄ</label>
                            <input type="text" x-model="exportSuffixLeft" placeholder="R" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">ÂéüÂõæ2ÂêéÁºÄ</label>
                            <input type="text" x-model="exportSuffixLeft2" placeholder="G" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">ÁõÆÊ†áÂõæÂêéÁºÄ</label>
                            <input type="text" x-model="exportSuffixRight" placeholder="T" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">TXTÊñá‰ª∂ÂëΩÂêçË∑üÈöè</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" x-model="exportTxtFollows" value="left" class="text-violet-600 focus:ring-violet-500">
                                <span class="text-xs text-gray-700">ÂéüÂõæ1</span>
                            </label>
                            <label class="flex items-center space-x-1 cursor-pointer">
                                <input type="radio" x-model="exportTxtFollows" value="right" class="text-violet-600 focus:ring-violet-500">
                                <span class="text-xs text-gray-700">ÁõÆÊ†áÂõæ</span>
                            </label>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">
                        Á§∫‰æã: 1_R.png, 1_G.png, 1_T.png, 1_T.txt
                    </p>
                </div>
                <!-- AIToolkit ÂëΩÂêçËÆæÁΩÆ -->
                <div x-show="exportNamingMode === 'aitoolkit'" x-transition class="space-y-3 bg-blue-50 rounded-lg p-3">
                    <div>
                        <label class="block text-xs font-medium text-gray-600 mb-1">Êñá‰ª∂Â§πÂâçÁºÄ</label>
                        <input type="text" x-model="exportFolderPrefix" placeholder="aitoolkit" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        <p class="text-xs text-gray-400 mt-1">ÁîüÊàê: <span x-text="exportFolderPrefix || 'aitoolkit'"></span>_R, <span x-text="exportFolderPrefix || 'aitoolkit'"></span>_T Êñá‰ª∂Â§π</p>
                    </div>
                    <div class="grid grid-cols-3 gap-2">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">ÂéüÂõæ1ÂêéÁºÄ</label>
                            <input type="text" x-model="exportSuffixLeft" placeholder="R" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">ÂéüÂõæ2ÂêéÁºÄ</label>
                            <input type="text" x-model="exportSuffixLeft2" placeholder="G" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">ÁõÆÊ†áÂõæÂêéÁºÄ</label>
                            <input type="text" x-model="exportSuffixRight" placeholder="T" class="w-full px-2 py-1.5 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-violet-500">
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">TXTÂëΩÂêçË∑üÈöè</label>
                            <div class="flex space-x-3">
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="radio" x-model="exportTxtFollows" value="left" class="text-violet-600 focus:ring-violet-500">
                                    <span class="text-xs text-gray-700">ÂéüÂõæ</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="radio" x-model="exportTxtFollows" value="right" class="text-violet-600 focus:ring-violet-500">
                                    <span class="text-xs text-gray-700">ÁõÆÊ†áÂõæ</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">TXTÊîæÁΩÆÊñá‰ª∂Â§π</label>
                            <div class="flex space-x-3">
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="radio" x-model="exportTxtFolderFollows" value="left" class="text-violet-600 focus:ring-violet-500">
                                    <span class="text-xs text-gray-700">ÂéüÂõæÂ§π</span>
                                </label>
                                <label class="flex items-center space-x-1 cursor-pointer">
                                    <input type="radio" x-model="exportTxtFolderFollows" value="right" class="text-violet-600 focus:ring-violet-500">
                                    <span class="text-xs text-gray-700">ÁõÆÊ†áÂõæÂ§π</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <p class="text-xs text-gray-500">
                        Á§∫‰æã: aitoolkit_R/1_R.png, aitoolkit_T/1_T.png, aitoolkit_T/1_T.txt
                    </p>
                </div>
                <div class="bg-gray-50 rounded-lg p-3" x-show="exportNamingMode === 'default'">
                    <p class="text-xs text-gray-600">
                        <span class="font-medium">ÈªòËÆ§Ê†ºÂºèËØ¥ÊòéÔºö</span><br>
                        Êñá‰ª∂ÂëΩÂêçÔºö1_0.png + 1_1.png + 1_1.txt ...<br>
                        ÈÄÇÂêàÁõ¥Êé•Áî®‰∫é LoRA/Dreambooth ËÆ≠ÁªÉ
                    </p>
                </div>
                <div class="flex space-x-3 pt-2">
                    <button @click="showExportDialog = false" class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        ÂèñÊ∂à
                    </button>
                    <button @click="exportPairs()" class="flex-1 px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                        ‚¨áÔ∏è ÂºÄÂßãÂØºÂá∫
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂØºÂá∫ÊàêÂäüÂºπÁ™ó -->
    <div x-show="showExportSuccessDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm">
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">ÂØºÂá∫ÊàêÂäüÔºÅ</h3>
                <p class="text-sm text-gray-600 mb-4 break-all" x-text="exportedFilePath"></p>
                <p class="text-sm text-gray-500 mb-4">ÊòØÂê¶ÊâìÂºÄÂØºÂá∫Êñá‰ª∂Â§πÔºü</p>
                <div class="flex space-x-3">
                    <button @click="showExportSuccessDialog = false" class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        ÂÖ≥Èó≠
                    </button>
                    <button @click="openExportFolder()" class="flex-1 px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                        üìÇ ÊâìÂºÄÊñá‰ª∂Â§π
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ËÆæÁΩÆÂºπÁ™ó -->
    <div x-show="showSettingsModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showSettingsModal = false">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Ê†áÈ¢òÊ†è -->
            <div class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800">‚öôÔ∏è ÈÖçÁΩÆ‰∏≠ÂøÉ</h2>
                <button @click="showSettingsModal = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <!-- Tab ÂàáÊç¢ÊåâÈíÆ -->
            <div class="bg-gray-50 border-b border-gray-200 px-6 py-3">
                <div class="flex space-x-2">
                    <button @click="settingsTab = 'tagging'; promptTemplateMode = 'tagging'" 
                            :class="settingsTab === 'tagging' ? 'bg-violet-600 text-white shadow-md' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'" 
                            class="px-4 py-2 rounded-lg transition-all font-medium text-sm">
                        üñºÔ∏è ÂõæÂÉèÂèçÊé®Ê®°Âûã
                    </button>
                    <button @click="settingsTab = 'editing'; promptTemplateMode = 'editing'" 
                            :class="settingsTab === 'editing' ? 'bg-violet-600 text-white shadow-md' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'" 
                            class="px-4 py-2 rounded-lg transition-all font-medium text-sm">
                        ‚úèÔ∏è ÂõæÂÉèÁºñËæëÊ®°Âûã
                    </button>
                    <button @click="settingsTab = 'apikey'" 
                            :class="settingsTab === 'apikey' ? 'bg-violet-600 text-white shadow-md' : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'" 
                            class="px-4 py-2 rounded-lg transition-all font-medium text-sm">
                        üîë API Key ÈÖçÁΩÆ
                    </button>
                </div>
            </div>

            <!-- ÂÜÖÂÆπÂå∫Âüü -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- ÂõæÂÉèÂèçÊé®Ê®°Âûã Tab -->
                <div x-show="settingsTab === 'tagging'" class="space-y-4">
                    <div class="bg-violet-50 border border-violet-200 rounded-lg p-3 mb-4">
                        <p class="text-sm text-violet-700">üìå ÂõæÂÉèÂèçÊé®Ê®°ÂûãÁî®‰∫éÂçïÂõæÊâìÊ†áÔºåÊ†πÊçÆÂõæÁâáÂÜÖÂÆπÁîüÊàêÊèèËø∞ÊñáÊú¨„ÄÇ</p>
                    </div>
                    
                    <!-- Ê®°ÊùøÈÄâÊã©‰∏ãÊãâ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©Ê®°ÊùøÊñá‰ª∂</label>
                        <div class="flex space-x-2">
                            <select x-model="selectedTaggingTemplate" @change="onTemplateSelect('tagging')" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">-- ÈÄâÊã©Ê®°Êùø --</option>
                                <template x-for="tpl in templateFiles.filter(t => t.mode === 'tagging')" :key="tpl.filename">
                                    <option :value="tpl.filename" x-text="tpl.name"></option>
                                </template>
                            </select>
                            <button @click="loadTemplateFiles()" class="px-3 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors" title="Âà∑Êñ∞">
                                üîÑ
                            </button>
                        </div>
                    </div>

                    <!-- ÂΩìÂâçÊ®°ÊùøÂÜÖÂÆπ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Á≥ªÁªüÊèêÁ§∫ËØç</label>
                        <textarea rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none" x-model="selectedPromptTemplate.system_prompt" @blur="saveConfig()"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Áî®Êà∑Êåá‰ª§</label>
                        <textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none" x-model="selectedPromptTemplate.user_prompt" @blur="saveConfig()"></textarea>
                    </div>

                    <!-- Ê®°ÊùøÊìç‰Ωú -->
                    <div class="flex items-center space-x-2 pt-2">
                        <input type="text" x-model="newPromptTemplateName" placeholder="Êñ∞Ê®°ÊùøÂêçÁß∞" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                        <button @click="saveAsTemplateFile()" class="px-3 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors text-sm font-medium">‰øùÂ≠ò‰∏∫Êñá‰ª∂</button>
                        <button @click="updateTemplateFile()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">Êõ¥Êñ∞Ê®°Êùø</button>
                        <button @click="deleteTemplateFile()" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium">Âà†Èô§</button>
                    </div>
                </div>

                <!-- ÂõæÂÉèÁºñËæëÊ®°Âûã Tab -->
                <div x-show="settingsTab === 'editing'" class="space-y-4">
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                        <p class="text-sm text-blue-700">üìå ÂõæÂÉèÁºñËæëÊ®°ÂûãÁî®‰∫éÊàêÂØπÂõæÁâáÔºåÂàÜÊûê‰∏§Âº†ÂõæÁâáÁöÑÂèòÂåñÂπ∂ÁîüÊàêÁºñËæëÊèêÁ§∫ËØç„ÄÇ</p>
                    </div>
                    
                    <!-- Ê®°ÊùøÈÄâÊã©‰∏ãÊãâ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ÈÄâÊã©Ê®°ÊùøÊñá‰ª∂</label>
                        <div class="flex space-x-2">
                            <select x-model="selectedEditingTemplate" @change="onTemplateSelect('editing')" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="">-- ÈÄâÊã©Ê®°Êùø --</option>
                                <template x-for="tpl in templateFiles.filter(t => t.mode === 'editing')" :key="tpl.filename">
                                    <option :value="tpl.filename" x-text="tpl.name"></option>
                                </template>
                            </select>
                            <button @click="loadTemplateFiles()" class="px-3 py-2 bg-gray-100 text-gray-600 rounded-lg hover:bg-gray-200 transition-colors" title="Âà∑Êñ∞">
                                üîÑ
                            </button>
                        </div>
                    </div>

                    <!-- ÂΩìÂâçÊ®°ÊùøÂÜÖÂÆπ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Á≥ªÁªüÊèêÁ§∫ËØç</label>
                        <textarea rows="6" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none" x-model="selectedPromptTemplate.system_prompt" @blur="saveConfig()"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Áî®Êà∑Êåá‰ª§</label>
                        <textarea rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none" x-model="selectedPromptTemplate.user_prompt" @blur="saveConfig()"></textarea>
                    </div>

                    <!-- Ê®°ÊùøÊìç‰Ωú -->
                    <div class="flex items-center space-x-2 pt-2">
                        <input type="text" x-model="newPromptTemplateName" placeholder="Êñ∞Ê®°ÊùøÂêçÁß∞" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                        <button @click="saveAsTemplateFile()" class="px-3 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors text-sm font-medium">‰øùÂ≠ò‰∏∫Êñá‰ª∂</button>
                        <button @click="updateTemplateFile()" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">Êõ¥Êñ∞Ê®°Êùø</button>
                        <button @click="deleteTemplateFile()" class="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium">Âà†Èô§</button>
                    </div>
                </div>

                <!-- API Key ÈÖçÁΩÆ Tab -->
                <div x-show="settingsTab === 'apikey'" class="space-y-5" x-data="{ showKey: false }">
                    <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
                        <p class="text-sm text-amber-700">üîê API Key ÈÖçÁΩÆÁã¨Á´ãÂ≠òÂÇ®Âú® apikey.json Êñá‰ª∂‰∏≠Ôºå‰∏ç‰ºö‰∏éÊèêÁ§∫ËØçÊ®°ÊùøÊ∑∑Ê∑Ü„ÄÇ</p>
                    </div>

                    <!-- ÈÄâÊã©Ê∏†ÈÅì -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">API Ê∏†ÈÅì</label>
                        <div class="grid grid-cols-3 gap-3">
                            <template x-for="(provider, key) in apikeyConfig.providers" :key="key">
                                <button @click="apikeyConfig.current_provider = key" 
                                        :class="apikeyConfig.current_provider === key ? 'bg-purple-100 border-purple-500 text-purple-700' : 'bg-white border-gray-300 text-gray-700'" 
                                        class="px-4 py-3 border-2 rounded-lg hover:border-purple-400 transition-colors text-sm font-medium">
                                    <span x-text="providerNames[key]"></span>
                                </button>
                            </template>
                        </div>
                    </div>

                    <!-- ÂΩìÂâçÊ∏†ÈÅìÁöÑ API Key -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span x-text="providerNames[apikeyConfig.current_provider]"></span> API Key
                        </label>
                        <div class="flex space-x-2">
                            <div class="relative flex-1">
                                <input :type="showKey ? 'text' : 'password'" 
                                       x-model="apikeyConfig.providers[apikeyConfig.current_provider].api_key" 
                                       placeholder="sk-xxxxxxxxxxxxxxxx" 
                                       class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <button type="button" @click="showKey = !showKey" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors">
                                    <svg x-show="!showKey" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg>
                                    <svg x-show="showKey" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path></svg>
                                </button>
                            </div>
                            <button @click="testApiConnection(apikeyConfig.current_provider)" 
                                    :disabled="apiTestStatus[apikeyConfig.current_provider] === 'testing'"
                                    :class="{
                                        'bg-gray-100 text-gray-600 hover:bg-gray-200': !apiTestStatus[apikeyConfig.current_provider],
                                        'bg-blue-100 text-blue-600': apiTestStatus[apikeyConfig.current_provider] === 'testing',
                                        'bg-green-100 text-green-600': apiTestStatus[apikeyConfig.current_provider] === 'success',
                                        'bg-red-100 text-red-600': apiTestStatus[apikeyConfig.current_provider] === 'failed'
                                    }"
                                    class="px-4 py-3 rounded-lg transition-colors font-medium text-sm whitespace-nowrap">
                                <span x-show="!apiTestStatus[apikeyConfig.current_provider]">Ê£ÄÊµã</span>
                                <span x-show="apiTestStatus[apikeyConfig.current_provider] === 'testing'">Ê£ÄÊµã‰∏≠...</span>
                                <span x-show="apiTestStatus[apikeyConfig.current_provider] === 'success'">‚úì ÊàêÂäü</span>
                                <span x-show="apiTestStatus[apikeyConfig.current_provider] === 'failed'">‚úó Â§±Ë¥•</span>
                            </button>
                        </div>
                    </div>

                    <!-- Base URL -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Base URL</label>
                        <input type="text" 
                               x-model="apikeyConfig.providers[apikeyConfig.current_provider].base_url" 
                               placeholder="https://api.example.com/v1" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    </div>

                    <!-- Ê®°ÂûãÈÄâÊã©ÔºàËá™ÂÆö‰πâ‰∏ãÊãâÔºâ -->
                    <div x-data="{ modelDropdownOpen: false }">
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-sm font-medium text-gray-700">ÈªòËÆ§Ê®°Âûã</label>
                            <button @click="openModelManageDialog()" class="text-xs text-violet-600 hover:text-violet-800 font-medium">‚öô Ê®°ÂûãÁÆ°ÁêÜ</button>
                        </div>
                        <div class="relative">
                            <!-- ÈÄâ‰∏≠ÊòæÁ§∫ -->
                            <button @click="modelDropdownOpen = !modelDropdownOpen" 
                                    @click.away="modelDropdownOpen = false"
                                    type="button"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-white text-left flex items-center justify-between focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <span class="truncate" x-text="getCurrentProviderModels().find(m => m.id === apikeyConfig.model)?.name || apikeyConfig.model || 'ÈÄâÊã©Ê®°Âûã'"></span>
                                <svg class="w-5 h-5 text-gray-400 transition-transform" :class="{ 'rotate-180': modelDropdownOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <!-- ‰∏ãÊãâÂàóË°®ÔºàÂêë‰∏äÂ±ïÂºÄÔºâ -->
                            <div x-show="modelDropdownOpen" 
                                 x-transition:enter="transition ease-out duration-100"
                                 x-transition:enter-start="opacity-0 scale-95"
                                 x-transition:enter-end="opacity-100 scale-100"
                                 x-transition:leave="transition ease-in duration-75"
                                 x-transition:leave-start="opacity-100 scale-100"
                                 x-transition:leave-end="opacity-0 scale-95"
                                 class="absolute z-50 bottom-full mb-1 w-full bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                <template x-for="(model, index) in getCurrentProviderModels()" :key="model.id">
                                    <div class="group flex items-center justify-between px-4 py-2.5 hover:bg-purple-50 cursor-pointer"
                                         :class="{ 'bg-purple-100': apikeyConfig.model === model.id }">
                                        <div class="flex-1 min-w-0" @click="apikeyConfig.model = model.id; modelDropdownOpen = false">
                                            <div class="text-sm truncate" :class="apikeyConfig.model === model.id ? 'text-purple-700 font-medium' : 'text-gray-700'" x-text="model.name"></div>
                                            <div class="text-xs text-gray-400 truncate" x-show="model.name !== model.id" x-text="model.id"></div>
                                        </div>
                                        <!-- Âà†Èô§ÊåâÈíÆÔºö‰ªÖËá™ÂÆö‰πâÊ®°ÂûãÊòæÁ§∫ÔºåÊÇ¨ÂÅúÊó∂Âá∫Áé∞ -->
                                        <button x-show="apikeyConfig.providers[apikeyConfig.current_provider].models && apikeyConfig.providers[apikeyConfig.current_provider].models.length > 0"
                                                @click.stop="deleteModelById(model.id)"
                                                class="ml-2 p-1 text-gray-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-all"
                                                title="Âà†Èô§Ê≠§Ê®°Âûã">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                            </svg>
                                        </button>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- AIÂàÜÊûêÁ≥ªÁªüÊèêÁ§∫ËØçÈÖçÁΩÆ -->
                    <div class="border-t border-gray-200 pt-5 mt-5">
                        <div class="flex items-center justify-between mb-2">
                            <label class="block text-sm font-medium text-gray-700">ü§ñ AIÂàÜÊûêÁ≥ªÁªüÊèêÁ§∫ËØç</label>
                            <button @click="apikeyConfig.ai_analysis_prompt = ''" class="text-xs text-gray-500 hover:text-violet-600 font-medium">ÊÅ¢Â§çÈªòËÆ§</button>
                        </div>
                        <p class="text-xs text-gray-500 mb-2">Ëá™ÂÆö‰πâËÆ≠ÁªÉÂàÜÊûêÂô®‰∏≠AIÂàÜÊûêÁöÑÁ≥ªÁªüÊèêÁ§∫ËØçÔºåÁïôÁ©∫Âàô‰ΩøÁî®ÈªòËÆ§ÊèêÁ§∫ËØç</p>
                        <textarea rows="5" 
                                  x-model="apikeyConfig.ai_analysis_prompt" 
                                  :placeholder="defaultAiAnalysisPrompt"
                                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm resize-none"></textarea>
                    </div>
                </div>
            </div>

            <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
            <div class="bg-gray-50 border-t border-gray-200 px-6 py-4 flex justify-between items-center">
                <div class="flex space-x-3">
                    <button @click="importConfig()" class="px-4 py-2 bg-blue-50 text-blue-600 border border-blue-200 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium">
                        üì• ÂØºÂÖ•ÈÖçÁΩÆ
                    </button>
                    <button @click="exportConfig()" class="px-4 py-2 bg-green-50 text-green-600 border border-green-200 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium">
                        üì§ ÂØºÂá∫ÈÖçÁΩÆ
                    </button>
                </div>
                <div class="flex space-x-3">
                    <button @click="showSettingsModal = false" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors">
                        ÂèñÊ∂à
                    </button>
                    <button @click="saveConfig(); saveApikeyConfig(); showSettingsModal = false" class="px-6 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                        ‰øùÂ≠òÂÖ®ÈÉ®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê®°ÂûãÁÆ°ÁêÜÂºπÁ™ó -->
    <div x-show="showModelManageDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]" @click.self="showModelManageDialog = false">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg">
            <div class="border-b border-gray-200 px-5 py-4 flex items-center justify-between">
                <h3 class="text-lg font-bold text-gray-800">Ê®°ÂûãÁÆ°ÁêÜ</h3>
                <button @click="showModelManageDialog = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-5">
                <div class="flex items-center justify-between mb-3">
                    <span class="text-sm text-gray-600">ÂΩìÂâçÊ∏†ÈÅì: <span class="font-medium text-violet-600" x-text="providerNames[apikeyConfig.current_provider]"></span></span>
                    <div class="flex items-center space-x-2">
                        <button @click="restoreDefaultModelsForCurrentProvider()" class="px-3 py-1.5 bg-gray-100 text-gray-700 text-sm rounded-lg hover:bg-gray-200 transition-colors">
                            ÊÅ¢Â§çÈªòËÆ§Ê®°Âûã
                        </button>
                        <button @click="openAddModelDialog()" class="px-3 py-1.5 bg-violet-600 text-white text-sm rounded-lg hover:bg-violet-700 transition-colors">
                            + Ê∑ªÂä†Ê®°Âûã
                        </button>
                    </div>
                </div>
                <div class="border border-gray-200 rounded-lg max-h-80 overflow-y-auto">
                    <template x-if="getCurrentProviderModels().length === 0">
                        <div class="p-6 text-center text-gray-400">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                            </svg>
                            <p>ÊöÇÊó†Ê®°ÂûãÔºåÁÇπÂáª‰∏äÊñπÊåâÈíÆÊ∑ªÂä†</p>
                        </div>
                    </template>
                    <template x-for="(model, index) in getCurrentProviderModels()" :key="model.id">
                        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-100 last:border-b-0 hover:bg-gray-50">
                            <div class="flex-1 min-w-0 mr-3">
                                <div class="text-sm font-medium text-gray-800 truncate" x-text="model.id"></div>
                            </div>
                            <button @click="deleteModelById(model.id)" 
                                    class="p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded transition-colors"
                                    title="Âà†Èô§Ê≠§Ê®°Âûã">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </template>
                </div>
            </div>
            <div class="border-t border-gray-200 px-5 py-4 flex justify-end">
                <button @click="showModelManageDialog = false" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm">
                    ÂÖ≥Èó≠
                </button>
            </div>
        </div>
    </div>

    <!-- Ê®°ÂûãÁºñËæëÂºπÁ™ó -->
    <div x-show="showModelEditDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[65]" @click.self="showModelEditDialog = false">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md">
            <div class="border-b border-gray-200 px-5 py-4 flex items-center justify-between">
                <h3 class="text-lg font-bold text-gray-800" x-text="editingModelIndex === -1 ? 'Ê∑ªÂä†Ê®°Âûã' : 'ÁºñËæëÊ®°Âûã'"></h3>
                <button @click="showModelEditDialog = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-5 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Ê®°Âûã ID <span class="text-red-500">*</span>
                    </label>
                    <input type="text" x-model="editingModel.id" placeholder="‰æãÂ¶Ç: gpt-4o, Qwen/Qwen2.5-VL-72B-Instruct" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                    <p class="mt-1 text-xs text-gray-500">APIË∞ÉÁî®Êó∂‰ΩøÁî®ÁöÑÊ®°ÂûãÊ†áËØÜÁ¨¶</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ê®°ÂûãÂêçÁß∞</label>
                    <input type="text" x-model="editingModel.name" placeholder="ÊòæÁ§∫ÂêçÁß∞ÔºàÂèØÈÄâÔºåÁïôÁ©∫Âàô‰ΩøÁî®IDÔºâ" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm">
                    <p class="mt-1 text-xs text-gray-500">Âú®‰∏ãÊãâÂàóË°®‰∏≠ÊòæÁ§∫ÁöÑÂèãÂ•ΩÂêçÁß∞</p>
                </div>
            </div>
            <div class="border-t border-gray-200 px-5 py-4 flex justify-end space-x-3">
                <button @click="showModelEditDialog = false" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors text-sm">
                    ÂèñÊ∂à
                </button>
                <button @click="saveModel()" class="px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors text-sm font-medium">
                    ‰øùÂ≠ò
                </button>
            </div>
        </div>
    </div>

    <!-- ËØ¶ÊÉÖÂºπÁ™ó -->
    <div x-show="detailImage" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="detailImage = null">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h2 class="text-lg font-bold text-gray-800" x-text="`ÁºñËæëËØ¶ÊÉÖ - ${detailImage?.name || ''}`"></h2>
                <button @click="detailImage = null" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="flex-1 flex overflow-hidden">
                <!-- Â∑¶‰æßÂ§ßÂõæÔºöÂ∞ΩÂèØËÉΩÈì∫Êª° -->
                <div class="w-1/2 p-3 flex items-center justify-center bg-gray-50">
                    <div class="w-full h-full flex items-center justify-center">
                        <img :src="detailImage?.thumbnail" :alt="detailImage?.name" class="w-full h-full object-contain rounded-lg shadow-lg">
                    </div>
                </div>

                <!-- Âè≥‰æßÁºñËæëÔºö‰∏äÊñπÂ∞∫ÂØ∏Ôºå‰∏ãÊñπÊñáÊú¨ -->
                <div class="w-1/2 p-6 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">ÊèêÁ§∫ËØçÂÜÖÂÆπ:</label>
                        <span class="text-xs text-gray-500" x-text="detailImage ? `${detailImage.width}x${detailImage.height}` : ''"></span>
                    </div>
                    <textarea x-model="detailImage.text" rows="20" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none"></textarea>
                    
                    <div class="flex space-x-3 mt-4">
                        <button @click="tagSingleImage(detailImage.id)" class="flex-1 px-4 py-3 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                            ‚ú® AI ÂèçÊé®
                        </button>
                        <button @click="saveDetail()" class="flex-1 px-4 py-3 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                            üíæ ‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÊàêÂØπËØ¶ÊÉÖÂºπÁ™ó -->
    <div x-show="detailPair" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="detailPair = null" 
         x-data="{ previewSide: 'left', showArrows: false, arrowTimer: null }" 
         @keydown.left.window="detailPair && (showArrows = true, clearTimeout(arrowTimer), arrowTimer = setTimeout(() => showArrows = false, 1500), navigatePair(-1))" 
         @keydown.right.window="detailPair && (showArrows = true, clearTimeout(arrowTimer), arrowTimer = setTimeout(() => showArrows = false, 1500), navigatePair(1))"
         @keydown.up.window.prevent="detailPair && (previewSide = previewSide === 'right' ? 'left' : 'right')"
         @keydown.down.window.prevent="detailPair && (previewSide = previewSide === 'left' ? 'right' : 'left')">
        <!-- Â∑¶ÁÆ≠Â§¥ÊåâÈíÆ -->
        <button @click="navigatePair(-1)" 
                x-show="showArrows && detailPairIndex > 0"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 -translate-x-4"
                x-transition:enter-end="opacity-100 translate-x-0"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 translate-x-0"
                x-transition:leave-end="opacity-0 -translate-x-4"
                class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/90 hover:bg-white rounded-full shadow-lg flex items-center justify-center text-gray-600 hover:text-violet-600 transition-all z-10">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
        </button>
        <!-- Âè≥ÁÆ≠Â§¥ÊåâÈíÆ -->
        <button @click="navigatePair(1)" 
                x-show="showArrows && detailPairIndex < pairs.length - 1"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 translate-x-4"
                x-transition:enter-end="opacity-100 translate-x-0"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 translate-x-0"
                x-transition:leave-end="opacity-0 translate-x-4"
                class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 bg-white/90 hover:bg-white rounded-full shadow-lg flex items-center justify-center text-gray-600 hover:text-violet-600 transition-all z-10">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
            </svg>
        </button>
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-hidden flex flex-col">
            <div class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h2 class="text-lg font-bold text-gray-800">
                    ËØ¶ÊÉÖ 
                    <span class="text-sm font-normal text-gray-500" x-text="'(' + (detailPairIndex + 1) + '/' + pairs.length + ')'"></span>
                </h2>
                <button @click="detailPair = null" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="flex-1 flex overflow-hidden">
                <!-- Â∑¶‰æßÔºöÂéüÂõæÂå∫Âüü -->
                <div class="w-1/2 p-6 bg-gray-50 overflow-auto border-r border-gray-200">
                    <h3 class="text-sm font-medium text-gray-700 mb-3">ÂéüÂõæ</h3>
                    <!-- Â§ßÂõæÈ¢ÑËßàÂå∫Âüü - Ê†πÊçÆpreviewSideÊòæÁ§∫‰∏çÂêåÂõæÁâáÔºåÊîØÊåÅÊãñÊãΩ‰∏ä‰º† -->
                    <div class="bg-white rounded-xl border border-blue-200 p-3 mb-4"
                         x-data="{ isDragging: false }"
                         @dragover.prevent="isDragging = true"
                         @dragleave.prevent="isDragging = false"
                         @drop.prevent="isDragging = false; handlePairImageDrop($event, previewSide)">
                        <div class="w-full aspect-square bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden relative transition-all"
                             :class="isDragging ? 'ring-4 ring-violet-400 bg-violet-50' : ''">
                            <!-- ÊãñÊãΩÊèêÁ§∫ÈÅÆÁΩ© -->
                            <div x-show="isDragging" class="absolute inset-0 bg-violet-100/80 flex flex-col items-center justify-center z-10">
                                <svg class="w-12 h-12 text-violet-500 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="text-violet-600 font-medium">ÈáäÊîæ‰ª•‰∏ä‰º†ÂõæÁâá</p>
                                <p class="text-violet-500 text-sm" x-text="previewSide === 'left' ? 'Â∞ÜËÆæÁΩÆ‰∏∫ÂéüÂõæ' : 'Â∞ÜËÆæÁΩÆ‰∏∫ÁõÆÊ†áÂõæ'"></p>
                            </div>
                            <!-- ÊòæÁ§∫Â∑¶‰æßÂõæÁâá -->
                            <template x-if="previewSide === 'left'">
                                <div class="w-full h-full flex items-center justify-center">
                                    <img x-show="detailPair.left && detailPair.left.path" 
                                         :src="'/api/file/image?path=' + encodeURIComponent(detailPair.left.path)" 
                                         @click="fullscreenImage = '/api/file/image?path=' + encodeURIComponent(detailPair.left.path)"
                                         class="w-full h-full object-contain cursor-zoom-in hover:opacity-90 transition-opacity">
                                    <div x-show="!detailPair.left" class="text-gray-400 text-sm text-center">
                                        <p>ÁÇπÂáª‰∏ãÊñπÁº©Áï•ÂõæÈÄâÊã©ÂõæÁâá</p>
                                        <p class="text-xs mt-1">ÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</p>
                                    </div>
                                </div>
                            </template>
                            <!-- ÊòæÁ§∫Âè≥‰æßÂõæÁâá -->
                            <template x-if="previewSide === 'right'">
                                <div class="w-full h-full flex items-center justify-center">
                                    <img x-show="detailPair.right && detailPair.right.path" 
                                         :src="'/api/file/image?path=' + encodeURIComponent(detailPair.right.path)" 
                                         @click="fullscreenImage = '/api/file/image?path=' + encodeURIComponent(detailPair.right.path)"
                                         class="w-full h-full object-contain cursor-zoom-in hover:opacity-90 transition-opacity">
                                    <div x-show="!detailPair.right" class="text-gray-400 text-sm text-center">
                                        <p>ÁÇπÂáª‰∏ãÊñπÁº©Áï•ÂõæÈÄâÊã©ÂõæÁâá</p>
                                        <p class="text-xs mt-1">ÊàñÊãñÊãΩÂõæÁâáÂà∞Ê≠§Â§Ñ</p>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                    
                    <!-- Â∫ïÈÉ®Áº©Áï•ÂõæÂå∫Âüü -->
                    <div class="flex items-start space-x-6">
                        <!-- ÂéüÂõæÁº©Áï•Âõæ -->
                        <div>
                            <p class="text-xs text-gray-500 mb-2">ÂéüÂõæ</p>
                            <div class="flex space-x-2">
                                <!-- ÂõæÁâá1 -->
                                <div class="relative group/thumb">
                                    <div @click="detailPair.left ? (previewSide = 'left') : selectPairSide(detailPair.id, 'left')" 
                                         class="w-16 h-16 rounded-lg p-0.5 cursor-pointer transition-all"
                                         :class="previewSide === 'left' ? 'bg-gradient-to-br from-blue-400 to-purple-500 shadow-lg' : 'bg-gray-200 hover:bg-gray-300'">
                                        <div class="w-full h-full bg-gray-100 rounded-md flex items-center justify-center overflow-hidden">
                                            <img x-show="detailPair.left && detailPair.left.thumbnail" :src="detailPair.left.thumbnail" class="w-full h-full object-cover">
                                            <span x-show="!detailPair.left" class="text-gray-400 text-[10px]">+</span>
                                        </div>
                                    </div>
                                    <!-- Âà†Èô§ÊåâÈíÆ -->
                                    <button x-show="detailPair.left" 
                                            @click.stop="clearPairSide('left')"
                                            class="absolute -top-1.5 -right-1.5 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity hover:bg-red-600 shadow-sm">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                    </button>
                                    <div class="mt-1 text-center text-[10px] text-gray-500">ÂõæÁâá1</div>
                                </div>
                                <!-- ÂõæÁâá2 (È¢ÑÁïô) -->
                                <div class="relative group/thumb">
                                    <div class="w-16 h-16 rounded-lg p-0.5 cursor-pointer bg-gray-200 hover:bg-gray-300 transition-all opacity-50">
                                        <div class="w-full h-full bg-gray-100 rounded-md flex items-center justify-center">
                                            <span class="text-gray-400 text-[10px]">+</span>
                                        </div>
                                    </div>
                                    <div class="mt-1 text-center text-[10px] text-gray-400">ÂõæÁâá2</div>
                                </div>
                            </div>
                        </div>
                        <!-- ÁõÆÊ†áÂõæÁº©Áï•Âõæ -->
                        <div>
                            <p class="text-xs text-gray-500 mb-2">ÁõÆÊ†áÂõæ</p>
                            <div class="relative group/thumb">
                                <div @click="detailPair.right ? (previewSide = 'right') : selectPairSide(detailPair.id, 'right')" 
                                     class="w-16 h-16 rounded-lg p-0.5 cursor-pointer transition-all"
                                     :class="previewSide === 'right' ? 'bg-gradient-to-br from-blue-400 to-purple-500 shadow-lg' : 'bg-gray-200 hover:bg-gray-300'">
                                    <div class="w-full h-full bg-gray-100 rounded-md flex items-center justify-center overflow-hidden">
                                        <img x-show="detailPair.right && detailPair.right.thumbnail" :src="detailPair.right.thumbnail" class="w-full h-full object-cover">
                                        <span x-show="!detailPair.right" class="text-gray-400 text-[10px]">+</span>
                                    </div>
                                </div>
                                <!-- Âà†Èô§ÊåâÈíÆ -->
                                <button x-show="detailPair.right" 
                                        @click.stop="clearPairSide('right')"
                                        class="absolute -top-1.5 -right-1.5 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover/thumb:opacity-100 transition-opacity hover:bg-red-600 shadow-sm">
                                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                </button>
                                <div class="mt-1 text-center text-[10px] text-gray-500">ÁõÆÊ†áÂõæ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Âè≥‰æßÔºöÊèêÁ§∫ËØçÁºñËæë -->
                <div class="w-1/2 p-6 flex flex-col bg-white">
                    <div class="flex items-center justify-between mb-3">
                        <label class="block text-sm font-medium text-gray-700">ÊèêÁ§∫ËØç</label>
                        <button @click="translatePairText()" class="text-sm text-violet-600 hover:text-violet-800 flex items-center space-x-1">
                            <span>ÁøªËØë</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                    </div>
                    <textarea x-model="detailPair.text" rows="12" placeholder="ËØ∑Áî®ÁÆÄÊ¥ÅÁöÑËØ≠Ë®ÄÊèèËø∞‰Ω†Â∏åÊúõÂ∞ÜÂéüÂõæËΩ¨Êç¢ÊàêÁöÑÁõÆÊ†áÂõæÈ£éÊ†ºÊàñÊïàÊûúÔºà‰ºòÂÖà‰ΩøÁî®Ëã±ÊñáÔºâ&#10;‰æãÂ¶ÇÔºö&#10;- ËΩ¨Êç¢‰∏∫ÂêâÂçúÂäõÂä®ÁîªÈ£éÊ†ºÔºàTransform into Ghibli anime styleÔºâ&#10;- ËΩ¨Êç¢‰∏∫Ê∞¥Â¢®ÁîªÈ£éÊ†ºÔºàTransform into ink wash painting styleÔºâ&#10;- ÁªôËßíËâ≤Êà¥‰∏äÁúºÈïúÔºàAdd glasses to the characterÔºâ" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm"></textarea>

                    <!-- AIÂèçÊé®ÊåâÈíÆ -->
                    <button @click="tagSinglePair(detailPair.id)" class="mt-4 px-4 py-2 text-violet-600 hover:text-violet-800 hover:bg-violet-50 rounded-lg transition-colors text-sm font-medium flex items-center justify-center space-x-2">
                        <span>‚ú®</span>
                        <span>Ëé∑ÂèñAIÊé®ËçêÊèêÁ§∫ËØç</span>
                    </button>

                    <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
                    <div class="flex space-x-3 mt-4 pt-4 border-t border-gray-100">
                        <button @click="detailPair = null" class="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">
                            ÂèñÊ∂à
                        </button>
                        <button @click="savePairDetail()" class="flex-1 px-4 py-3 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                            Á°ÆÂÆö
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êñ∞Â¢ûÊàêÂØπÁªÑÂºπÁ™ó -->
    <div x-show="showAddPairModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="closeAddPairModal()">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-5xl h-[80vh] flex flex-col overflow-hidden">
            <!-- Â§¥ÈÉ® -->
            <div class="px-6 py-4 border-b border-gray-100 flex items-center justify-between">
                <div>
                    <h3 class="text-lg font-bold text-gray-800">‰∏ä‰º†Á¥†Êùê</h3>
                    <p class="text-xs text-gray-500 mt-1">
                        ‚ìò Â¶ÇÈúÄ‰∏ä‰º†ÂéãÁº©ÂåÖËØ∑ÂâçÂæÄ <a href="#" @click.prevent="openTrainingDataFolder()" class="text-violet-600 hover:underline">Êï∞ÊçÆÁÆ°ÁêÜ</a> ËøõË°åÊìç‰Ωú
                    </p>
                </div>
                <button @click="closeAddPairModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- ÂÜÖÂÆπÂå∫ -->
            <div class="flex-1 flex flex-col p-6 bg-gray-50 overflow-hidden">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-sm text-gray-600">ËØ∑‰æùÊ¨°‰∏ä‰º†ÂõæÁâáÁªÑ</span>
                    <span class="text-sm text-gray-500" x-text="`Â∑≤‰∏ä‰º†: ${stagedPairs.length}/100`"></span>
                </div>

                <!-- Áº©Áï•ÂõæÂàóË°® (Ê∞¥Âπ≥ÊªöÂä®) -->
                <div class="flex space-x-4 overflow-x-auto pb-4 mb-4 min-h-[140px] px-2">
                    <template x-for="(pair, index) in stagedPairs" :key="pair.id">
                        <div 
                            @click="setCurrentStaged(index)"
                            class="relative flex-shrink-0 w-32 h-24 rounded-lg border-2 overflow-hidden cursor-pointer transition-all group mt-2"
                            :class="currentStagedIndex === index ? 'border-purple-600 ring-2 ring-purple-100 shadow-lg scale-105' : 'border-gray-200 hover:border-purple-300'"
                        >
                            <div class="flex h-full">
                                <div class="w-1/2 bg-gray-100 flex items-center justify-center border-r border-gray-100 overflow-hidden">
                                    <img x-show="pair.left" :src="pair.left" class="w-full h-full object-cover">
                                    <span x-show="!pair.left" class="text-xs text-gray-400">A</span>
                                </div>
                                <div class="w-1/2 bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img x-show="pair.right" :src="pair.right" class="w-full h-full object-cover">
                                    <span x-show="!pair.right" class="text-xs text-gray-400">B</span>
                                </div>
                            </div>
                            
                            <!-- Â∫èÂè∑Ê†áÁ≠æ -->
                            <div class="absolute top-1 left-1 px-1.5 py-0.5 bg-black/50 text-white text-[10px] rounded backdrop-blur-sm" x-text="`ÂõæÁâá${index + 1}`"></div>

                            <!-- Âà†Èô§ÊåâÈíÆ -->
                            <button 
                                @click.stop="removeStagedPair(index, $event)"
                                class="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 shadow-sm z-10"
                            >
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                    </template>

                    <!-- Ê∑ªÂä†Êñ∞ÁªÑÊåâÈíÆ -->
                    <div 
                        @click="addStagedPair()"
                        class="flex-shrink-0 w-32 h-24 mt-2 rounded-lg border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition-colors text-gray-400 hover:text-purple-600"
                    >
                        <svg class="w-8 h-8 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                        <span class="text-xs">Ê∑ªÂä†ÁªÑ</span>
                    </div>
                </div>

                <!-- ÂΩìÂâçÁºñËæëÂå∫Âüü -->
                <div class="flex-1 flex gap-6 items-center justify-center bg-white rounded-xl border border-dashed border-gray-200 p-8 relative overflow-hidden" x-show="stagedPairs.length > 0">
                    <!-- Ê∞¥Âç∞ËÉåÊôØ -->
                    <div class="absolute inset-0 pointer-events-none opacity-[0.02] flex items-center justify-center overflow-hidden -rotate-12 transform scale-150">
                        <div class="text-4xl font-bold space-y-12 text-center select-none text-gray-900 grid grid-cols-2 gap-12">
                             <template x-for="i in 20">
                                <div>Pandy AI Tagger</div>
                             </template>
                        </div>
                    </div>

                    <!-- Â∑¶‰æßÔºöÂéüÂõæ -->
                    <div class="w-1/2 h-full max-h-[400px] flex flex-col z-10">
                         <div 
                            @click="selectStagedFile('left')"
                            class="flex-1 bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl hover:border-violet-500 hover:bg-violet-50 transition-all cursor-pointer flex flex-col items-center justify-center group relative overflow-hidden shadow-sm hover:shadow-md"
                         >
                            <img x-show="stagedPairs[currentStagedIndex] && stagedPairs[currentStagedIndex].left" :src="stagedPairs[currentStagedIndex]?.left" class="absolute inset-0 w-full h-full object-contain p-2 bg-white/50 backdrop-blur-sm">
                            
                            <div x-show="!stagedPairs[currentStagedIndex]?.left" class="flex flex-col items-center text-gray-400 group-hover:text-violet-600 transition-colors">
                                <svg class="w-12 h-12 mb-2 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                <span class="text-lg font-medium">ÂéüÂõæ</span>
                            </div>
                         </div>
                    </div>

                    <!-- Âè≥‰æßÔºöÁõÆÊ†áÂõæ -->
                    <div class="w-1/2 h-full max-h-[400px] flex flex-col z-10">
                         <div 
                            @click="selectStagedFile('right')"
                            class="flex-1 bg-gray-50 border-2 border-dashed border-gray-300 rounded-xl hover:border-violet-500 hover:bg-violet-50 transition-all cursor-pointer flex flex-col items-center justify-center group relative overflow-hidden shadow-sm hover:shadow-md"
                         >
                            <img x-show="stagedPairs[currentStagedIndex] && stagedPairs[currentStagedIndex].right" :src="stagedPairs[currentStagedIndex]?.right" class="absolute inset-0 w-full h-full object-contain p-2 bg-white/50 backdrop-blur-sm">
                            
                            <div x-show="!stagedPairs[currentStagedIndex]?.right" class="flex flex-col items-center text-gray-400 group-hover:text-violet-600 transition-colors">
                                <svg class="w-12 h-12 mb-2 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                                <span class="text-lg font-medium">ÁõÆÊ†áÂõæ</span>
                            </div>
                         </div>
                    </div>
                </div>
            </div>

            <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
            <div class="px-6 py-4 border-t border-gray-100 flex justify-end space-x-3 bg-white">
                <button @click="closeAddPairModal()" class="px-6 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    ÂèñÊ∂à
                </button>
                <button @click="confirmAddPairs()" class="px-6 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium shadow-md hover:shadow-lg">
                    Á°ÆÂÆö
                </button>
            </div>
        </div>
    </div>

    <!-- ÂØºÂÖ•Êï∞ÊçÆÈõÜËßÑÂàôÈÖçÁΩÆÂºπÁ™ó -->
    <div x-show="showImportRulesModal" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showImportRulesModal = false">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h3 class="text-lg font-bold text-gray-800">üìÇ ÂØºÂÖ•Êï∞ÊçÆÈõÜ</h3>
                <button @click="showImportRulesModal = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-6 space-y-4">
                <!-- ÂØºÂÖ•Ê®°ÂºèÈÄâÊã© -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ÂØºÂÖ•Ê®°Âºè</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="importRules.mode" value="default" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">ÈªòËÆ§Ê®°Âºè</span>
                        </label>
                        <label class="flex items-center space-x-2 cursor-pointer">
                            <input type="radio" x-model="importRules.mode" value="match" class="text-violet-600 focus:ring-violet-500">
                            <span class="text-sm text-gray-700">ËßÑÂàôÂåπÈÖç</span>
                        </label>
                    </div>
                </div>

                <!-- ÈªòËÆ§Ê®°ÂºèËØ¥Êòé -->
                <div x-show="importRules.mode === 'default'" class="bg-violet-50 p-3 rounded-lg text-xs text-violet-700">
                    <p class="font-medium mb-1">ÈªòËÆ§Ê®°Âºè</p>
                    <p>ÂØºÂÖ•Êñá‰ª∂Â§π‰∏≠ÊâÄÊúâÂõæÁâáÂíåtxtÊñá‰ª∂ÔºåÊåâÊñá‰ª∂ÂêçÈ°∫Â∫èËá™Âä®ÈÖçÂØπ„ÄÇ</p>
                    <p class="mt-1">ÊØè‰∏§Âº†ÂõæÁâáÁªÑÊàê‰∏ÄÂØπÔºàÁ¨¨1Âº†‰∏∫ÂéüÂõæÔºåÁ¨¨2Âº†‰∏∫ÁõÆÊ†áÂõæÔºâ„ÄÇ</p>
                </div>

                <!-- ËßÑÂàôÂåπÈÖçÊ®°ÂºèËÆæÁΩÆ -->
                <div x-show="importRules.mode === 'match'" class="space-y-4">
                    <p class="text-sm text-gray-600">ËØ∑ËÆæÁΩÆÊñá‰ª∂ÂêçÂåπÈÖçËßÑÂàôÔºåÁ≥ªÁªüÂ∞ÜÂè™ÂØºÂÖ•Á¨¶ÂêàËßÑÂàôÁöÑÊàêÂØπÂõæÁâá„ÄÇ</p>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÂéüÂõæÂêéÁºÄ</label>
                            <div class="flex items-center">
                                <span class="text-gray-400 mr-1 text-sm">*_</span>
                                <input type="text" x-model="importRules.left_suffix" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent text-sm" placeholder="R">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ÁõÆÊ†áÂõæÂêéÁºÄ</label>
                            <div class="flex items-center">
                                <span class="text-gray-400 mr-1 text-sm">*_</span>
                                <input type="text" x-model="importRules.right_suffix" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-violet-500 focus:border-transparent text-sm" placeholder="T">
                            </div>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">TXTÊñá‰ª∂Ë∑üÈöè</label>
                        <div class="flex space-x-4">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" x-model="importRules.txt_follows" value="left" class="text-violet-600 focus:ring-violet-500">
                                <span class="text-sm text-gray-700">ÂéüÂõæ</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="radio" x-model="importRules.txt_follows" value="right" class="text-violet-600 focus:ring-violet-500">
                                <span class="text-sm text-gray-700">ÁõÆÊ†áÂõæ</span>
                            </label>
                        </div>
                    </div>

                    <div class="bg-violet-50 p-3 rounded-lg text-xs text-violet-700">
                        <p class="font-medium mb-1">ÂåπÈÖçÁ§∫‰æã</p>
                        <p>ËÆæÁΩÆÂéüÂõæÂêéÁºÄ: <span x-text="importRules.left_suffix || 'R'"></span>, ÁõÆÊ†áÂõæÂêéÁºÄ: <span x-text="importRules.right_suffix || 'T'"></span></p>
                        <p class="mt-1">‚úÖ ÂåπÈÖç: 001_<span x-text="importRules.left_suffix || 'R'"></span>.png + 001_<span x-text="importRules.right_suffix || 'T'"></span>.png</p>
                        <p>‚úÖ TXT: 001_<span x-text="importRules.txt_follows === 'left' ? (importRules.left_suffix || 'R') : (importRules.right_suffix || 'T')"></span>.txt</p>
                    </div>
                </div>
            </div>

            <div class="px-6 py-4 border-t border-gray-100 flex justify-end space-x-3 bg-gray-50">
                <button @click="showImportRulesModal = false" class="px-4 py-2 bg-white border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                    ÂèñÊ∂à
                </button>
                <button @click="confirmImportFolder()" class="px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">
                    üìÇ ÈÄâÊã©Êñá‰ª∂Â§πÂπ∂ÂØºÂÖ•
                </button>
            </div>
        </div>
    </div>

    <!-- ÈáçÂëΩÂêçÂØπËØùÊ°Ü -->
    <div x-show="showRenameDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showRenameDialog = false">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
            <h3 class="text-lg font-bold mb-4">ÊâπÈáèÈáçÂëΩÂêç</h3>
            <input type="text" x-model="renamePrefix" placeholder="ËæìÂÖ•Êñá‰ª∂ÂêçÂâçÁºÄ (Â¶Ç: lora_data)" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4">
            <div class="flex space-x-3">
                <button @click="showRenameDialog = false" class="flex-1 px-4 py-2 bg-gray-200 rounded-lg">ÂèñÊ∂à</button>
                <button @click="batchRename()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†ÊñáÊú¨ÂØπËØùÊ°Ü -->
    <div x-show="showAddTextDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showAddTextDialog = false">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
            <h3 class="text-lg font-bold mb-4">ÊâπÈáèÊ∑ªÂä†ÊñáÊú¨</h3>
            <input type="text" x-model="addTextValue" placeholder="ËæìÂÖ•Ë¶ÅÊ∑ªÂä†ÁöÑÊñáÊú¨ (Â¶Ç: PD_style)" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4">
            <div class="flex space-x-3">
                <button @click="showAddTextDialog = false" class="flex-1 px-4 py-2 bg-gray-200 rounded-lg">ÂèñÊ∂à</button>
                <button @click="batchAddText()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Ë£ÅÂàáÂØπËØùÊ°Ü -->
    <div x-show="showResizeDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showResizeDialog = false">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-96">
            <h3 class="text-lg font-bold mb-4">ÊâπÈáèË£ÅÂàá</h3>
            <input type="number" x-model="resizeValue" placeholder="ÊúÄÈïøËæπÂ§ßÂ∞è (px)" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4">
            <div class="flex space-x-3">
                <button @click="showResizeDialog = false" class="flex-1 px-4 py-2 bg-gray-200 rounded-lg">ÂèñÊ∂à</button>
                <button @click="batchResize()" class="flex-1 px-4 py-2 bg-purple-600 text-white rounded-lg">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- ÈÄöÁî®Á°ÆËÆ§ÂØπËØùÊ°Ü -->
    <div x-show="showConfirmDialog" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60]" @click.self="handleConfirm(false)">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-96 transform transition-all"
             x-show="showConfirmDialog"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95">
            <div class="flex items-center justify-center w-12 h-12 mx-auto bg-yellow-100 rounded-full mb-4">
                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-bold text-center mb-2" x-text="confirmTitle"></h3>
            <p class="text-gray-500 text-center mb-6 text-sm" x-text="confirmMessage"></p>
            <div class="flex space-x-3">
                <button @click="handleConfirm(false)" class="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors font-medium">ÂèñÊ∂à</button>
                <button @click="handleConfirm(true)" class="flex-1 px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 transition-colors font-medium">Á°ÆÂÆö</button>
            </div>
        </div>
    </div>

    <!-- Toast ÈÄöÁü•ÂÆπÂô® -->
    <div class="fixed top-20 right-4 z-[100] flex flex-col space-y-3 pointer-events-none">
        <template x-for="note in notifications" :key="note.id">
            <div
                x-show="note.show"
                x-transition:enter="transition ease-out duration-300"
                x-transition:enter-start="opacity-0 translate-x-8"
                x-transition:enter-end="opacity-100 translate-x-0"
                x-transition:leave="transition ease-in duration-200"
                x-transition:leave-start="opacity-100 translate-x-0"
                x-transition:leave-end="opacity-0 translate-x-8"
                class="pointer-events-auto min-w-[300px] max-w-md bg-white rounded-lg shadow-lg border-l-4 p-4 flex items-start space-x-3"
                :class="{
                    'border-green-500': note.type === 'success',
                    'border-red-500': note.type === 'error',
                    'border-yellow-500': note.type === 'warning',
                    'border-blue-500': note.type === 'info'
                }"
            >
                <div class="flex-shrink-0 pt-0.5">
                    <span x-show="note.type === 'success'" class="text-green-500 text-lg">‚úÖ</span>
                    <span x-show="note.type === 'error'" class="text-red-500 text-lg">‚ùå</span>
                    <span x-show="note.type === 'warning'" class="text-yellow-500 text-lg">‚ö†Ô∏è</span>
                    <span x-show="note.type === 'info'" class="text-blue-500 text-lg">‚ÑπÔ∏è</span>
                </div>
                <div class="flex-1">
                    <p class="text-sm text-gray-800 font-medium whitespace-pre-wrap leading-relaxed" x-text="note.message"></p>
                </div>
                <button @click="removeNotification(note.id)" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </template>
    </div>

    <!-- ËÆ∞ÂΩïËØ¶ÊÉÖÂºπÁ™ó -->
    <div x-show="showRecordDetail" x-cloak class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showRecordDetail = false">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
                <h2 class="text-xl font-bold text-gray-800">üìã ËÆ∞ÂΩïËØ¶ÊÉÖ</h2>
                <button @click="showRecordDetail = false" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-6 space-y-4" x-show="recordDetail">
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><span class="text-gray-500">Ê®°ÂûãÂêçÁß∞:</span> <span class="font-medium" x-text="recordDetail?.model_name"></span></div>
                    <div><span class="text-gray-500">ÂàÜÊûêÊó∂Èó¥:</span> <span class="font-medium" x-text="recordDetail?.analysis_date"></span></div>
                    <div class="col-span-2"><span class="text-gray-500">Êó•ÂøóÊñá‰ª∂:</span> <span class="font-medium text-xs break-all" x-text="recordDetail?.log_file_path"></span></div>
                </div>
                <hr>
                <h4 class="font-bold text-green-700">ËÆ≠ÁªÉÈÖçÁΩÆ</h4>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><span class="text-gray-500">ÊÄªEpochÊï∞:</span> <span class="font-medium" x-text="recordDetail?.num_epochs || 'N/A'"></span></div>
                    <div><span class="text-gray-500">Â≠¶‰π†Áéá:</span> <span class="font-medium" x-text="recordDetail?.learning_rate || 'N/A'"></span></div>
                    <div><span class="text-gray-500">Â≠¶‰π†ÁéáË∞ÉÂ∫¶Âô®:</span> <span class="font-medium" x-text="recordDetail?.lr_scheduler || 'N/A'"></span></div>
                    <div><span class="text-gray-500">Batch Size:</span> <span class="font-medium" x-text="recordDetail?.train_batch_size || 'N/A'"></span></div>
                </div>
                <hr>
                <h4 class="font-bold text-green-700">ËÆ≠ÁªÉÁªìÊûú</h4>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><span class="text-gray-500">ÊúÄ‰Ω≥Epoch:</span> <span class="font-medium text-green-600" x-text="recordDetail?.best_epoch"></span></div>
                    <div><span class="text-gray-500">ÊúÄ‰Ω≥Loss:</span> <span class="font-medium text-green-600" x-text="recordDetail?.best_val_loss?.toFixed(10)"></span></div>
                    <div><span class="text-gray-500">ÊúÄÂ∑ÆLoss:</span> <span class="font-medium" x-text="recordDetail?.worst_val_loss?.toFixed(10)"></span></div>
                    <div><span class="text-gray-500">Âπ≥ÂùáLoss:</span> <span class="font-medium" x-text="recordDetail?.avg_val_loss?.toFixed(10)"></span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÂõæÁâáÈ¢ÑËßàÊ®°ÊÄÅÊ°Ü -->
    <div x-show="previewImage" x-cloak class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50" @click="previewImage = null">
        <div class="relative max-w-[90vw] max-h-[90vh]">
            <img :src="previewImage" class="max-w-full max-h-[90vh] object-contain" @click.stop>
            <button @click="previewImage = null" class="absolute top-4 right-4 w-10 h-10 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-colors">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- ÂÖ®Â±èÂõæÁâáÊü•ÁúãÂºπÁ™ó -->
    <div x-show="fullscreenImage" x-cloak 
         x-data="{ 
             scale: 1, 
             translateX: 0, 
             translateY: 0, 
             isDragging: false, 
             startX: 0, 
             startY: 0,
             handleWheel(e) {
                 e.preventDefault();
                 const delta = e.deltaY > 0 ? -0.1 : 0.1;
                 this.scale = Math.max(0.5, Math.min(5, this.scale + delta));
             },
             handleMouseDown(e) {
                 if (this.scale <= 1) return;
                 this.isDragging = true;
                 this.startX = e.clientX - this.translateX;
                 this.startY = e.clientY - this.translateY;
             },
             handleMouseMove(e) {
                 if (this.isDragging) {
                     this.translateX = e.clientX - this.startX;
                     this.translateY = e.clientY - this.startY;
                 }
             },
             handleMouseUp() {
                 this.isDragging = false;
             },
             resetView() {
                 this.scale = 1;
                 this.translateX = 0;
                 this.translateY = 0;
             }
         }"
         x-init="$watch('fullscreenImage', () => resetView())"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 bg-black/95 flex items-center justify-center z-[100]" 
         @mousemove="handleMouseMove($event)"
         @mouseup="handleMouseUp()"
         @mouseleave="handleMouseUp()"
         @mousedown.self.prevent="handleMouseDown($event)">
        <div class="relative w-full h-full flex items-center justify-center p-4 overflow-hidden">
            <img :src="fullscreenImage" 
                 class="max-w-full max-h-full object-contain transition-transform duration-100"
                 :class="isDragging ? 'cursor-grabbing' : (scale > 1 ? 'cursor-grab' : 'cursor-zoom-in')"
                 :style="'transform: scale(' + scale + ') translate(' + (translateX/scale) + 'px, ' + (translateY/scale) + 'px)'"
                 @click.stop
                 @wheel.prevent="handleWheel($event)"
                 @mousedown.prevent="handleMouseDown($event)">
            <!-- ÂÖ≥Èó≠ÊåâÈíÆ -->
            <button @click.stop="fullscreenImage = null" class="absolute top-6 right-6 w-12 h-12 bg-white/10 hover:bg-white/20 rounded-full flex items-center justify-center text-white transition-colors backdrop-blur-sm">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
            <!-- Áº©ÊîæÊØî‰æãÊòæÁ§∫ -->
            <div class="absolute top-6 left-6 px-3 py-1.5 bg-white/10 rounded-full text-white/80 text-sm backdrop-blur-sm">
                <span x-text="Math.round(scale * 100) + '%'"></span>
            </div>
            <!-- ÊèêÁ§∫ÊñáÂ≠ó -->
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 text-white/60 text-sm">
                ÊªöËΩÆÁº©Êîæ ¬∑ ÊãñÊãΩÁßªÂä® ¬∑ ÁÇπÂáªÂè≥‰∏äËßí X ÈÄÄÂá∫
            </div>
            <!-- ÈáçÁΩÆÊåâÈíÆ -->
            <button x-show="scale !== 1" @click.stop="resetView()" class="absolute bottom-6 right-6 px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded-full text-white/80 text-sm backdrop-blur-sm transition-colors">
                ÈáçÁΩÆËßÜÂõæ
            </button>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
