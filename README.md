# Pandy AI 打标器 V1.0

<div align="center">

**高效的 AI 数据集打标工具**

专为 LoRA 和 Stable Diffusion 训练者设计的 Web 打标工具

支持多图批量处理 • AI 自动反推描述 • 图像编辑指令生成 • 多种导出格式

[功能特性](#功能特性) • [快速开始](#快速开始) • [使用指南](#使用指南) • [配置说明](#配置说明) • [常见问题](#常见问题)

</div>

---

## 📋 目录

- [简介](#简介)
- [功能特性](#功能特性)
- [系统要求](#系统要求)
- [快速开始](#快速开始)
- [使用指南](#使用指南)
- [配置说明](#配置说明)
- [目录结构](#目录结构)
- [常见问题](#常见问题)
- [更新日志](#更新日志)

---

## 📖 简介

Pandy AI 打标器是一款基于 Web 的专业打标工具，利用先进的 AI 视觉模型自动生成高质量的图像描述。采用标签页独立设计，支持快速模式切换，特别适用于：

- 🎨 **LoRA 训练**：为 Stable Diffusion LoRA 模型准备高质量训练数据
- 📊 **数据集标注**：批量处理图像并生成准确的描述标签
- 🔄 **图像编辑训练**：成对处理原图→目标图，生成编辑指令
- 💬 **AI 智能对话**：与 AI 进行图像相关的智能交互
- 📈 **训练分析**：可视化分析训练日志和数据集质量

---
## 📄 许可证
双击bat，弹出终端自动运行，就能使用了。
本软件需要激活码才能使用。点击获取机械码，然后机械码发给我获取激活码激活。
联系微信：PQB0660
详细使用关注文档：
https://ai.feishu.cn/wiki/WI3HwYpBAiJ4ZPkeB0ScWxiTn2f?from=from_copylink

## ✨ 功能特性

### 界面设计

- **标签页独立布局**：四个主要功能板块相互独立，互不干扰
- **快速模式切换**：顶部按钮直接切换，无需重新加载
- **独立界面布局**：每个模式拥有专属的操作界面和工具栏

### 🎯 四大核心功能

#### 🏷️ 文生图反推模式 (Tagging Mode)

**适用场景**：通用的文生图数据集打标

**核心功能**：
- **多种导入方式**
  - 单图上传：拖拽或点击上传单张图片
  - 批量上传：一次性选择多张图片
  - 文件夹递归导入：自动扫描子文件夹中的所有图片
  
- **AI 智能反推**
  - 调用多模态大模型自动生成图像描述
  - 支持自定义提示词模板
  - 实时预览生成结果
  
- **手动编辑优化**
  - 实时编辑和优化提示词
  - 支持标签添加、删除、排序
  - 批量文本操作（添加触发词、清空文本等）
  
- **批量处理工具**
  - 批量重命名：自定义前缀 + 自动编号
  - 批量裁切：等比例缩放至指定尺寸（默认 1024px）
  - 格式转换：JPG/PNG/WEBP 互转
  - 选择管理：全选/反选/删除选中

#### 🎨 图像编辑模型反推模式 (Editing Mode)

**适用场景**：图像编辑模型训练（原图→目标图成对处理）

**导入模式**：

| 模式 | 说明 | 文件匹配规则 | 示例 |
|------|------|--------------|------|
| **默认模式** | 导入所有图片，按顺序配对 | 顺序配对 | 1.png + 2.png → 原图 + 目标图 |
| **规则匹配模式** | 自定义后缀，只导入成对图片 | 后缀匹配 | 001_R.png + 001_T.png + 001_T.txt |

**配置选项**：
- **原图后缀**：自定义原图标识（默认：`_R`）
- **目标图后缀**：自定义目标图标识（默认：`_T`）
- **TXT 跟随**：选择文本文件跟随原图或目标图

**批量操作工具**：

| 功能 | 说明 | 适用场景 |
|------|------|----------|
| 选择管理 | 全选/反选/删除选中 | 快速管理大量素材 |
| 批量重命名 | 自定义前缀 + 自动编号 | 格式化数据集文件名 |
| 批量裁切 | 等比例缩放至指定尺寸 | 优化训练效率（默认 1024px）|
| 批量文本操作 | 添加触发词/标签，清空文本 | 统一添加水印词或风格标签 |
| 格式转换 | JPG/PNG/WEBP 互转 | 统一数据集格式 |

**AI 反推功能**：
- 自动对比原图和目标图的差异
- 生成精确的图像编辑指令
- 适用于图像编辑模型（如 InstructPix2Pix）训练

#### 📊 训练分析器模式 (Analyzer Mode)

**核心功能**：
- **训练日志分析**：自动解析训练日志文件
- **数据可视化**：生成训练曲线和统计图表
- **数据集质量分析**：评估标注质量和数据分布
- **Excel 导出**：导出详细的训练数据表格
- **历史记录管理**：保存和对比不同训练的结果

#### 💬 AI 对话模式 (Chat Mode)

**核心功能**：
- **智能图像对话**：上传图像与 AI 进行深度交流
- **多轮对话支持**：保持上下文连贯性
- **对话历史管理**：自动保存所有对话记录
- **历史回溯**：随时查看和继续之前的对话
- **图像理解**：支持图像内容分析、风格讨论等

### 🚀 技术特点

- ✅ **多 AI 提供商支持**：SiliconFlow、ModelScope、Tuzi 等
- ✅ **灵活的模板系统**：自定义提示词模板，适配不同需求
- ✅ **本地化 Web 界面**：无需安装依赖，浏览器即可使用
- ✅ **高效批量处理**：支持数百张图片同时处理
- ✅ **多格式支持**：JPG、PNG、WEBP 等主流格式
- ✅ **数据安全**：本地运行，数据不上传云端
- ✅ **实时预览**：所见即所得的编辑体验

---

## 💻 系统要求

- **操作系统**：Windows 10/11（64位）
- **内存**：建议 4GB 以上
- **存储空间**：至少 500MB 可用空间
- **网络**：需要互联网连接（调用 AI API）
- **浏览器**：现代浏览器（Chrome、Edge、Firefox 等）

---

## 🚀 快速开始

### 1. 下载与解压

下载 `Pandy AI 打标器_V1.0` 文件夹到本地目录。

### 2. 启动程序

双击运行 `启动 Pandy AI 打标器.bat` 文件：

```
Pandy AI 打标器_V1.0/
└── 启动 Pandy AI 打标器.bat  ← 双击运行
```

程序将自动：
- 启动本地服务器
- 打开浏览器访问 Web 界面
- 显示控制台日志

> ⚠️ **注意**：请勿关闭控制台窗口，关闭将停止服务

### 3. 激活软件

首次使用需要激活软件：

**获取激活码**：
- 联系微信：**PQB0660**
- 详细文档：[Pandy AI 打标器_V1.0 使用文档](https://example.com)

**激活步骤**：

1. **获取机器码**
   - 启动软件后，点击"获取机器码"
   - 示例机器码：`264793680105927`

2. **输入激活码**
   - 将机器码发送给开发者获取激活码
   - 示例激活码：`ECC02-B268B-D868E-FPDYY`
   - 在软件中输入激活码完成激活

> 💡 **提示**：首次激活需要机器码和激活码两个码，激活后永久有效

### 4. 配置 API

配置 AI 服务提供商：

1. 在 Web 界面中进入设置页面
2. 选择 API 提供商（SiliconFlow、ModelScope 等）
3. 输入您的 API Key
4. 选择要使用的模型
5. 保存配置

### 5. 开始使用

选择对应的功能模式：

- **🏷️ 文生图反推**：批量上传图像，AI 自动生成描述
- **🎨 图像编辑模型**：导入成对图像，生成编辑指令
- **📊 训练分析器**：导入训练日志，分析训练数据
- **💬 AI 对话**：上传图像与 AI 智能对话

---

## 📚 使用指南

### 🏷️ 文生图反推模式详解

#### 1. 导入图像

**方式一：单图上传**
- 点击上传按钮或拖拽图片到上传区域
- 支持 JPG、PNG、WEBP 格式

**方式二：批量上传**
- 点击"批量上传"按钮
- 按住 Ctrl/Cmd 选择多张图片
- 一次性导入所有选中图片

**方式三：文件夹递归导入**
- 点击"导入文件夹"按钮
- 选择包含图片的文件夹
- 自动扫描所有子文件夹中的图片

#### 2. AI 智能反推

**基础操作**：
1. 选择要反推的图片（支持多选）
2. 点击"AI 反推"按钮
3. 等待 AI 生成描述（显示进度条）
4. 查看和编辑生成的描述

**自定义模板**：
- 在设置中选择或创建提示词模板
- 模板位置：`apikey_config/默认单图反推.json`
- 可以调整 system_prompt 和 user_prompt

**示例模板**：
```json
{
  "name": "详细描述模板",
  "mode": "tagging",
  "system_prompt": "You are an AI prompt expert...",
  "user_prompt": "Describe this image in detail..."
}
```

#### 3. 手动编辑优化

**编辑功能**：
- 实时编辑文本框中的描述
- 添加、删除、调整标签顺序
- 支持快捷键操作（Ctrl+S 保存）

**批量文本操作**：
- **添加触发词**：为所有选中图片添加统一的触发词
- **添加标签**：批量添加风格标签、质量标签等
- **清空文本**：清除选中图片的所有描述
- **文本替换**：批量替换特定词汇

#### 4. 批量处理工具

**批量重命名**：
```
设置前缀：dataset_
起始编号：001
结果：dataset_001.png, dataset_002.png, ...
```

**批量裁切**：
- 目标尺寸：1024x1024（可自定义）
- 裁切模式：等比例缩放 / 居中裁切
- 保持宽高比：自动填充或裁剪

**格式转换**：
- JPG → PNG：无损转换
- PNG → JPG：可设置质量（80-100）
- WEBP：高压缩比，适合大批量数据

#### 5. 导出数据

**导出选项**：
- 导出为 TXT 文件（每张图片对应一个 .txt）
- 导出为 JSON 文件（包含所有元数据）
- 导出为 CSV 文件（表格格式）

---

### 🎨 图像编辑模型反推模式详解

#### 1. 选择导入模式

**默认模式**（适合新手）：
- 导入所有图片，按顺序自动配对
- 第 1 张 → 原图，第 2 张 → 目标图
- 第 3 张 → 原图，第 4 张 → 目标图
- 以此类推...

**规则匹配模式**（推荐）：
- 根据文件名后缀自动匹配
- 只导入符合规则的成对图片
- 避免误配对

#### 2. 配置匹配规则

**文件命名规范**：
```
001_R.png  ← 原图（Reference）
001_T.png  ← 目标图（Target）
001_T.txt  ← 描述文本（可选）
```

**配置参数**：
- **原图后缀**：`_R`（可自定义为 `_before`、`_src` 等）
- **目标图后缀**：`_T`（可自定义为 `_after`、`_dst` 等）
- **TXT 跟随**：选择文本文件跟随原图还是目标图

**示例配置**：
```
原图后缀：_before
目标图后缀：_after
TXT跟随：目标图

文件结构：
photo_001_before.jpg
photo_001_after.jpg
photo_001_after.txt  ← 跟随目标图
```

#### 3. 导入成对图像

**操作步骤**：
1. 点击"导入文件夹"按钮
2. 选择包含成对图片的文件夹
3. 系统自动匹配并显示配对结果
4. 检查配对是否正确（显示原图和目标图预览）

**配对检查**：
- 绿色标记：配对成功
- 红色标记：缺少配对图片
- 黄色标记：文件名不符合规则

#### 4. AI 生成编辑指令

**反推流程**：
1. 选择要反推的图片对（支持多选）
2. 点击"AI 反推编辑指令"按钮
3. AI 自动对比原图和目标图
4. 生成精确的编辑描述

**生成示例**：
```
原图：一个女孩站在公园里
目标图：同一个女孩，但背景变成了海滩

生成指令：
"Change the background from park to beach, 
keep the girl's pose and appearance unchanged"
```

#### 5. 批量操作

**批量裁切**：
- 同时裁切原图和目标图
- 保持相同的裁切区域
- 确保训练时的对应关系

**批量重命名**：
- 自动保持原图和目标图的配对关系
- 统一命名格式

**批量导出**：
- 导出成对的图片和描述文本
- 生成训练所需的目录结构

---

### 📊 训练分析器模式详解

#### 1. 导入训练日志

**支持的日志格式**：
- Stable Diffusion WebUI 训练日志
- Kohya SS 训练日志
- 自定义格式日志（需配置解析规则）

**导入方式**：
- 将日志文件放入 `training_analyzer/training_log/` 目录
- 或通过界面直接上传

#### 2. 数据分析

**自动解析内容**：
- 训练损失（Loss）曲线
- 学习率（Learning Rate）变化
- 训练步数和时间统计
- GPU 使用率和内存占用

**可视化图表**：
- 损失曲线图
- 学习率曲线图
- 对比不同训练的结果

#### 3. 数据集质量分析

**分析维度**：
- 图片数量和分辨率分布
- 标签长度和词频统计
- 重复图片检测
- 标注质量评分

#### 4. 导出报告

**导出格式**：
- Excel 表格（详细数据）
- PDF 报告（可视化图表）
- JSON 数据（原始数据）

**保存位置**：
- `training_analyzer/training_excel/`

---

### 💬 AI 对话模式详解

#### 1. 开始对话

**基础对话**：
- 在输入框中输入问题
- 点击发送或按 Enter 键
- AI 实时回复

**图像对话**：
- 点击上传图片按钮
- 选择要讨论的图片
- 输入关于图片的问题
- AI 基于图片内容回答

#### 2. 对话场景

**图像分析**：
```
用户：这张图片的主要元素是什么？
AI：这张图片包含一个女孩、一只猫和花园背景...
```

**风格讨论**：
```
用户：这张图片是什么艺术风格？
AI：这是典型的赛博朋克风格，具有霓虹灯、未来城市等元素...
```

**标注优化**：
```
用户：帮我优化这个提示词：girl, cat, garden
AI：建议优化为：a young girl with long hair, 
playing with a fluffy cat in a blooming garden...
```

#### 3. 历史记录管理

**自动保存**：
- 所有对话自动保存
- 保存位置：`ai_chat/chat_history/`

**历史查看**：
- 按时间浏览历史对话
- 搜索特定对话内容
- 继续之前的对话

**导出对话**：
- 导出为 Markdown 文件
- 导出为 PDF 文件
- 分享对话记录

---

## ⚙️ 配置说明

### 配置文件结构

```
apikey_config/
├── apikey.json              # API 配置（敏感信息）⭐
├── config.json              # 提示词模板配置 ⭐
├── 默认单图反推.json         # 默认单图反推模板
└── 默认编辑模型.json         # 默认编辑模板
```

### apikey.json（API 配置）

包含敏感信息，请勿分享：

```json
{
  "providers": {
    "SiliconFlow": {
      "api_key": "your-api-key-here",
      "base_url": "https://api.siliconflow.cn/v1",
      "models": ["model-name"]
    }
  },
  "current_provider": "SiliconFlow",
  "model": "model-name",
  "license_code": "your-license-code"
}
```

### config.json（提示词模板）

可以安全分享的用户配置：

```json
{
  "prompt_templates": {
    "tagging": {
      "selected": "template-id",
      "templates": []
    },
    "editing": {
      "selected": "template-id",
      "templates": []
    }
  }
}
```

### 自定义提示词模板

创建自定义模板：

```json
{
  "name": "我的模板",
  "mode": "tagging",
  "system_prompt": "你是一个专业的图像分析师...",
  "user_prompt": "请详细描述这张图像..."
}
```

### 配置管理建议

✅ **备份配置**
```bash
# 备份敏感信息（不要分享）
备份 apikey.json

# 备份提示词模板（可以分享）
备份 config.json
```

✅ **分享模板**
- 只分享 `config.json` 和自定义模板文件
- 不要分享 `apikey.json`（包含 API 密钥）

✅ **重置配置**
- 删除 `apikey.json` - 重置 API 配置
- 删除 `config.json` - 恢复默认模板

---

## 📁 目录结构

```
Pandy AI 打标器_V1.0/
│
├── PandyTagger.exe                    # 主程序
├── 启动 Pandy AI 打标器.bat            # 启动脚本
│
├── ai_chat/                           # AI 聊天
│   └── chat_history/                  # 聊天历史记录
│
├── apikey_config/                     # 配置文件
│   ├── apikey.json                    # API 配置（敏感）
│   ├── config.json                    # 提示词模板
│   ├── 默认单图反推.json               # 默认单图模板
│   └── 默认编辑模型.json               # 默认编辑模板
│
├── training_analyzer/                 # 训练分析器
│   ├── log_record/                    # 日志记录
│   ├── training_excel/                # 导出的 Excel
│   ├── training_log/                  # 训练日志
│   └── training_log_history/          # 历史日志
│
├── training_datas/                    # 训练数据
│   └── input_datas_image/             # 输入图像
│
├── training_edit_tmp/                 # 编辑临时文件
│   └── __temp_cache__/                # 临时缓存
│
├── training_prompt_tmp/               # 提示词临时文件
│
└── _internal/                         # 内部依赖文件
    ├── frontend/                      # Web 前端
    ├── backend/                       # 后端逻辑
    └── ...                            # 其他依赖库
```

---

## ❓ 常见问题

### Q1: 程序无法启动？

**解决方案**：
1. 确认是否为 Windows 10/11 64位系统
2. 检查是否有杀毒软件拦截
3. 以管理员身份运行
4. 查看控制台错误信息

### Q2: 浏览器没有自动打开？

**解决方案**：
1. 手动打开浏览器
2. 访问 `http://localhost:5000`（默认端口）
3. 检查防火墙设置

### Q3: API 调用失败？

**解决方案**：
1. 检查 API Key 是否正确
2. 确认网络连接正常
3. 验证 API 提供商服务状态
4. 检查 API 额度是否充足

### Q4: 图像无法上传？

**解决方案**：
1. 确认图像格式（支持 JPG、PNG、WebP 等）
2. 检查图像大小（建议小于 10MB）
3. 确认文件路径没有特殊字符
4. 尝试重新启动程序

### Q5: 如何获取激活码？

**获取方式**：
- 联系微信：**PQB0660**
- 提供机器码获取激活码
- 激活码格式：20 位字符（16 位十六进制 + "PDYY" 后缀）
- 示例：`ECC02-B268B-D868E-FPDYY`

### Q6: 如何获取 API Key？

**获取方式**：
- **SiliconFlow**：访问 https://siliconflow.cn
- **ModelScope**：访问 https://modelscope.cn
- **其他提供商**：查看各自官网

### Q7: 配置文件丢失怎么办？

**解决方案**：
1. 程序会自动创建默认配置
2. 从备份恢复配置文件
3. 重新配置 API 和模板

### Q8: 图像编辑模式如何正确配对？

**解决方案**：
1. 使用规则匹配模式
2. 按照命名规范：`001_R.png` + `001_T.png`
3. 确保原图和目标图的前缀一致
4. 检查配对结果中的绿色标记

### Q9: 如何更新软件？

**更新步骤**：
1. 备份 `apikey_config/` 目录
2. 下载新版本
3. 替换程序文件
4. 恢复配置文件
5. 激活码无需重新获取

---

## 📝 更新日志

### V1.0（当前版本）

**新功能**：
- ✨ 单图反推功能
- ✨ 编辑模型分析
- ✨ AI 聊天功能
- ✨ 训练分析器
- ✨ 多 API 提供商支持
- ✨ 自定义提示词模板

**优化**：
- 🔧 简化配置文件结构（从 5 个减少到 2 个）
- 🔧 改进 Web 界面
- 🔧 优化批量处理性能

---

## 🤝 支持与反馈

如有问题或建议，请通过以下方式联系：

- � **微[信**：PQB0660（获取激活码、技术支持）
- � **：使用文档**：Pandy AI 打标器_V1.0 详细文档
- �  **问题反馈**：通过微信反馈 Bug 和建议
- 💡 **功能建议**：欢迎提出新功能需求

---

## ⚠️ 注意事项

1. **API 密钥安全**：请妥善保管您的 API Key，不要分享给他人
2. **网络连接**：使用过程中需要稳定的网络连接
3. **数据备份**：定期备份重要的配置和数据
4. **合规使用**：请遵守 API 提供商的使用条款
5. **版权声明**：生成的内容版权归用户所有

---

<div align="center">

**Pandy AI 打标器 V1.0**

让 AI 标注更简单、更高效

</div>
